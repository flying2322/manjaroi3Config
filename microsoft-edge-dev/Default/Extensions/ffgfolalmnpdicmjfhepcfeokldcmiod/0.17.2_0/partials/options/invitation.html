
<div  ng-controller="InvitationController" ng-hide="anonymous()">

    <div class="bind-email-wrapper reward-wrapper slide-up" ng-controller="BindEmailController" style="background-color:#f8f8f8;padding:3px;" ng-if="showInvitation('user-bind-edu-email2')">
        <div class="reward-header">
            <h2 ng-click="toggleReward('bind-email-wrapper')">
                <!-- <span class="label label-primary">1</span> -->
                <i class="fa fa-trophy" style="color:#4cae4c;" aria-hidden="true"></i>
                
                <b>{{'options.invitation.bind_edu_reward_2'|translate}}</b>
                <small class="for_more_detail">({{'options.invitation.click_for_more'|translate}})</small>
                <a class="toggle-reward glyphicon glyphicon glyphicon-chevron-up pull-right" ></a>
            </h2>
            <div class="clearfix"></div>
        </div>


        <div class="rules" styles="border-top: 1px solid #eee;" >
            <h3><i class="fa fa-plus-circle" aria-hidden="true"></i><b translate='options.invitation.prerequisites'></b></h3>

            <ul class="steps">
                <!--
                <li>
                    <div>
                    <span class="label" ng-class="{'label-info': !$root.user.profile.emailBinded, 'label-success': $root.user.profile.emailBinded}">
                        <span ng-if="!$root.user.profile.emailBinded">1</span>
                        <span ng-if="$root.user.profile.emailBinded"><span class="glyphicon glyphicon-ok"></span></span>
                    </span>
                    <span ng-if="!$root.user.profile.emailBinded">{{'options.invitation.bind_edu_reward_2_step_1'|translate}}</span>
                    <span ng-if="$root.user.profile.emailBinded">{{'options.invitation.bind_edu_reward_2_step_1'|translate}}(<span style="color:#5cb85c">{{'options.invitation.bounded'|translate}}</span>)</span>
                    
                    <span ng-show="!showEmailInput && !$root.user.profile.emailVerified" ng-hide="$root.isGuest()">
                        <span class="text-muted">
                            <a href="" ng-click="showEmailInput=true;focusEmailInput=true;">
                                <small ng-if="!$root.user.profile.emailBinded">{{'options.invitation.email_click_set'|translate}}</small>
                                <small ng-if="$root.user.profile.emailBinded">{{'options.invitation.email_click_change'|translate}}</small>
                            </a>
                        </span>
                    </span>
                    <small ng-show="$root.isGuest()">
                        ({{'options.layout.no_account_caveats'|translate}}

                        <a href="" ng-click="openAnonymousModal()">{{'options.layout.signup_now'|translate}}</a>
                        )
                    </small>
                    </div>
                    <div class="col-xs-5" style="margin-top:8px">
                        <bind-email-input manual-focus="focusEmailInput" binded-email="{{$root.user.profile.email}}" ng-show="showEmailInput" ng-if="$root.user.profile.emailBinded"></bind-email-input>
                        <bind-email-input manual-focus="focusEmailInput" binded-email="" ng-show="showEmailInput" ng-if="!$root.user.profile.emailBinded"></bind-email-input>
                    </div>
                    <div class="clearfix"></div>
                </li>-->
                <li>
                    <span class="label" ng-class="{'label-info': !$root.user.profile.emailVerified, 'label-success': $root.user.profile.emailVerified}">
                        <span ng-if="!$root.user.profile.emailVerified">1</span>
                        <span ng-if="$root.user.profile.emailVerified"><span class="glyphicon glyphicon-ok"></span></span>
                    </span>
                    <span>
                        
                        {{'options.invitation.bind_edu_reward_1_step_1'|translate}}
                    </span>
                </li>
                <li>
                    <span class="label" ng-class="{'label-info': !$root.user.profile.emailVerified, 'label-success': $root.user.profile.emailVerified}">
                        <span ng-if="!$root.user.profile.emailVerified">2</span>
                        <span ng-if="$root.user.profile.emailVerified"><span class="glyphicon glyphicon-ok"></span></span>
                    </span>
                    <span>
                        
                        {{'options.invitation.bind_edu_reward_2_step_2'|translate}}
                    </span>
                </li>
                <li>
                    <span class="label label-success">{{'options.invitation.reward'|translate}}</span>
                    
                    <span translate="options.invitation.bind_edu_reward_explained_part_1"></span>
                    <span>{{$root.user.bind_edu_reward}}</span>
                    <span translate="options.invitation.bind_edu_reward_explained_part_2"></span>
                </li>
            </ul>
        </div>
    </div>


    <div class="reward-list-wrapper clearfix" style="position: relative;">
        <div class="alert {{alertStyle}} text-center" ng-show="showAlertFetch">{{alertText}}</div>
        <h4 class="rewards">
            <i class="fa fa-th-large" aria-hidden="true"></i>
            {{'options.invitation.rewards'|translate}}

            <a href="" class="btn" style="padding: 0;color: black;cursor:point"
               ng-click="reloadInvitations()" ng-mouseenter="hovering_CT=true" ng-mouseleave="hovering_CT=false"
               bs-tooltip="{title: ('common.reload'|translate)}" data-placement="top"
               >

                <i class="fa fa-refresh" ng-class="{'color_emphasis':hovering_CT}" aria-hidden="true"></i>
            </a>
        </h4>
        <table class="invitation table">
            <thead>
            <tr>
                <th class="name" translate="options.invitation.name"></th>
                <th class="account" translate="options.invitation.beneficiary"></th>
                <th class="status">{{'options.invite_codes.invite_status'|translate}}</span></th>
                <th class="time"><span bs-tooltip="{title: ('options.invitation.invitation_expire_notice'|translate) }">{{'options.invitation.invitation_expire'|translate}}</span></th>
                <th class="action text-right" translate="options.invitation.fetch_reward"></th>
            </tr>
            </thead>
            <tbody>
            <tr class="text-muted" ng-show="$root.invitationList && !$root.invitationList.length">
                <td colspan="3" translate="options.invitation.no_reward_so_far"></td>
            </tr>
            <tr ng-repeat="invitation in $root.invitationList">
                <th class="name">
                    {{ invitation.caption }}
                </th>
                <td class="account" ng-switch="isMe(invitation.sender)">
                    <span ng-switch-when="true">
                        {{ invitation.receiver }}
                    </span>
                    <span ng-switch-when="false">
                        {{ 'options.invitation.me' | translate }}
                        <span class="text-muted" ng-if="!$root.isAdmin(invitation.sender)">
                            ( {{ invitation.sender }} <span ng-show="invitation.sender_action_caption">{{invitation.sender_action_caption}}</span> )
                        </span>
                    </span>
                </td>
                <td class="status">
                    <span class="label label-default" ng-show="!invitation.expired && invitation.status !== 'rewardable'">{{invitation.status_caption}}</span>
                    
                    <span class="text-success" ng-show="!invitation.expired && invitation.status === 'rewardable'">
                        {{invitation.status_caption}}
                    </span>
                    <span ng-show="invitation.expired">&nbsp;</span>
                    <!--
                    <span class="text-success" ng-show="invitation.can_fetch_reward && invitation.status === 'rewardable'">

                        {{'options.invitation.invitation_rewardable'|translate}}

                    </span>-->
                </td>
                <td class="time">
             
                    <span ng-show="invitation.expired" class="label label-default">{{'options.invitation.expired'|translate}}</span>
                    <span ng-show="!invitation.expired" style="color:black" bs-tooltip="{title: (invitation.expire | date: 'yyyy-MM-dd HH:mm:ss') }">{{invitation.expire | date: 'yyyy-MM-dd'}}</span>
                </td>
                <td class="action text-right" ng-if="!invitation.expired" ng-show="invitation.status === 'rewardable'">
                    <button class="btn btn-xs btn-success" ng-if="!invitation.fetching"
                            ng-show="invitation.can_fetch_reward"
                            ng-click="$root.fetchInvitationReward(invitation)">
                            {{invitation.reward_caption}}
                    </button>
                    <button class="btn btn-xs  btn-secondary" ng-if="invitation.fetching"
                            ng-show="invitation.can_fetch_reward" disabled
                            ng-click="$root.fetchInvitationReward(invitation)">
                            <img src="/img/loading-bars.svg" alt="loading"/>
                    </button>
                    <span class="text-success" ng-hide="invitation.can_fetch_reward" translate="options.invitation.rewarded">
                    </span>
                </td>
                <td class="action text-right" ng-if="!invitation.expired" ng-show="invitation.status != 'rewardable'">
                    <span class="text-muted" translate="options.invitation.not_rewardable"></span>
                </td>
                <td class="action text-right" ng-if="invitation.expired">
                    <span class="text-muted" translate="options.invitation.expired"></span>
                </td>
            </tr>


        </table>



        <div>
                        <ul class="pagination" style="float:right;margin-top:10px;margin-right:10px;" ng-show="total_pages">
                            <li ng-class="{disabled: total_pages == 0 || total_pages == 1 || cur_page == 1}">
                                <a href="" ng-click="loadPrevInvitation()">
                                    <span aria-hidden="true">«</span>
                                    <span class="sr-only">Previous</span>
                                </a>
                            </li>

                            <li ng-class="{active: page == cur_page}" ng-repeat="page in pages">
                                <a href="" ng-click="loadInvitation(page)">
                                    <span aria-hidden="true">{{page}}</span>
                                </a>
                            </li>

                            <li ng-class="{disabled: total_pages == 0 || total_pages == 1 || cur_page == total_pages}">
                                <a href="" ng-click="loadNextInvitation()">
                                    <span aria-hidden="true">»</span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </li>
                        </ul>
        </div>
        
        <div class="sarsha-spinner-container" style="" ng-show="invitations_loading"> 
            <div class="sarsha-spinner"> <div class="spinner ng-scope"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div> </div> 
        </div>
    
    </div>
</div>