(function(){var e;e=function(e,r,i,t,s,o,n,u,a,c,l,d,h,p,f,v,g,m){var b,w,x,S;return"[userManager]",e.vip_duration=0,300,0,w={profile:{sid:"",uid:"",name:"",chicago_u:"",chicago_p:"",email:"",ip:"",ip_region:"",inviter:"",invite_url:"",emailVerified:!1,emailBinded:!1,until:null,vip_duration:0,sys_time:0,start_time:0,level:"",avatar:"",nickname:"",telegram:"",kicked:!1,render_host:"",notification_count:0,exchangable_wheat_score:0,wheat_exchange_rate:1600,active_invitation_code_count:0,active_coupon_count:0,vvip:!1,enterprise:!1,enterprise_allowance:0,wheat_collecting_disabled:!1,backup_ws_servers:[]},role:p.HACKER},this.getFingerPrint=function(){return"userManager-"+(this.load.toString().length+this.onProfile_.toString().length)},this.getSid=function(){return e.user.profile.sid},this.setSid=function(r){e.user.profile.sid=r},this.getUid=function(){return e.user.profile.uid},this.getChicagoUsername=function(){return e.user.profile.chicago_u},this.getChicagoPassword=function(){return e.user.profile.chicago_p},this.getVer=function(){return v},this.getUsername=function(){return e.user.profile.name},this.load=function(i){if(e.user.profile.sid=i.sid,i.uid&&(e.user.profile.uid=i.uid),e.user.profile.name=i.name,e.user.profile.chicago_u=i.chicago_u,e.user.profile.chicago_p=i.chicago_p,e.user.profile.until=i.until,e.user.profile.vip_duration=i.vip_duration,e.vip_duration=i.vip_duration,e.user.profile.sys_time=i.sys_time,e.user.profile.start_time=i.start_time,e.user.profile.level=i.level,e.user.profile.kicked=i.kicked,e.user.profile.email=i.email,e.user.profile.ip=i.ip,e.user.profile.ip_region=i.ip_region,e.user.profile.port=i.port,e.user.profile.inviter=i.inviter,e.user.profile.notification_count=i.notification_count,e.user.profile.exchangable_wheat_score=i.exchangable_wheat_score,e.user.profile.wheat_exchange_rate=i.wheat_exchange_rate,e.user.profile.vvip=i.vvip,e.user.profile.enterprise=i.enterprise,e.user.profile.enterprise_allowance=i.enterprise_allowance,e.user.profile.active_invitation_code_count=i.active_invitation_code_count,e.user.profile.active_coupon_count=i.active_coupon_count,i.avatar&&(e.user.profile.avatar=i.avatar),i.nickname&&(e.user.profile.nickname=i.nickname),i.telegram&&i.telegram.length>0&&(e.user.profile.telegram=i.telegram.hexDecode()),i.emailVerified&&(e.user.profile.emailVerified=i.emailVerified),i.emailBinded&&(e.user.profile.emailBinded=i.emailBinded),i.invite_url&&(e.user.profile.invite_url=i.invite_url),i.invite_qrcode_url&&(e.user.profile.invite_qrcode_url=i.invite_qrcode_url),i.order_url&&(e.user.profile.order_url=i.order_url),i.vipcode_url&&(e.user.profile.vipcode_url=i.vipcode_url),i.cart_url&&(e.user.profile.cart_url=i.cart_url),i.render_host&&(e.user.profile.render_host=i.render_host.hexDecode()),i.data_user_month&&(e.user.data_user_month=i.data_user_month),i.data_user_day&&(e.user.data_user_day=i.data_user_day),i.kicked?e.user.role=p.KICK_OUT:i.level?e.user.role=p.VIP:i.name?"guest"===i.name||i.name.startsWith("anonymous")?e.user.role=p.GUEST:e.user.role=p.USER:e.user.role=p.HACKER,e.user.error||(e.user.error={}),e.user.rewardable_invitation_count=i.rewardable_invitation_count?i.rewardable_invitation_count:0,i.last_wheat_action_time?e.user.last_wheat_action_time=i.last_wheat_action_time:e.user.last_wheat_action_time=(new Date).getTime(),e.user.total_wheat=i.total_wheat?i.total_wheat:0,i.wheats&&i.wheats.length>0){for(var t=-1,s=!1,o=0;o<i.wheats.length;o++){var n=i.wheats[o];n.status===f.READY&&(s=!0),n.status===f.UNFETCHED&&-1==t&&(t=o)}s||-1==t||(i.wheats[t].status=f.WAITING),e.user.wheats=i.wheats}else e.user.wheats=[];if(i.wheat_collecting_disabled&&(e.user.wheat_collecting_disabled=i.wheat_collecting_disabled),e.user.notifications=[],i.backup_ws_servers&&i.backup_ws_servers.length>0){e.user.profile.backup_ws_servers=[];for(o=0;o<i.backup_ws_servers.length;o++){var u=i.backup_ws_servers[o];u&&e.user.profile.backup_ws_servers.push(u)}}return e.user.bind_edu_reward="",r.info("[userManager]user load from :",i)},this.load_invitations=function(e,r){var i={invitations_page_rows:r,invitations_cur_page:e};return n.emit("invitations",i,function(e){})},this.loadVipCards=function(){return n.emit("vip-cards",{},function(e){})},this.loadInvoices=function(){return e.user.invoices_loading=!0,n.emit("invoices",{},function(e){})},this.loadCoupons=function(){return e.user.coupons_loading=!0,n.emit("coupons",{},function(e){})},this.reloadVIPCodes=function(){return e.user.vipcodes_loading=!0,n.emit("vipcodes",{},function(e){})},this.saveIpRegion=function(r,i){r&&""!==r&&(u.set("ip",r),e.user.profile.ip=r),i&&""!==i&&(u.set("ip_region",i),e.user.profile.ip_region=i)},this.saveSigninData=function(e,r){r.sid&&(r.sid=r.sid.hexDecode()),r.apiUrl&&(u.set("lastSignin_api",r.apiUr),r.apiUrl=r.apiUrl.hexDecode()),e.n&&(e.n=e.n.hexEncode()),e.p&&(e.p=a.md5(e.p)),e.ip_region?e.ip_region=e.ip_region.hexDecode():e.ip_region="",u.set("lastServer_scheme",e.lastServer_scheme),u.set("lastServer_host",e.lastServer_host),u.set("lastServer_port",e.lastServer_port),u.set("lastServer_contextPath",e.lastServer_contextPath),u.set("n",e.n),u.set("p",e.p),u.set("ip",e.ip),u.set("ip_region",e.ip_region),u.set("port",e.port)},this.beforeSignout=function(){u.get("rememberChecked",!1)||(u.set("lastSignin_api",""),u.set("lastServer_scheme",""),u.set("lastServer_host",""),u.set("lastServer_port",0),u.set("lastServer_contextPath",""),u.set("lastLoginName","")),u.remove("n"),u.remove("p"),u.remove("ip"),u.remove("ip_region"),u.remove("port"),e.signin=!1,e.user.role=p.HACKER,e.vip_duration=0,u.remove("vip_duration")},x=function(){var r;return r=angular.copy(e.user.profile),u.set("vip_duration",e.vip_duration),u.set("profile",r)},this.versionExpire=function(){e.signin||(e.signin=!0)},this.onStopped=function(){e.wsConnected=!1},this.onHeartbeat=function(){e.lastHeartBeat=(new Date).getTime(),e.wsConnected=!0},this.onNotificationNum=function(r){e.user.profile.notification_count=r.notification_count,e.user.rewardable_invitation_count=r.rewardable_invitation_count?r.rewardable_invitation_count:0,x()},this.onProfile_=(S=this,function(r){if(r.ip_region&&(r.ip_region=r.ip_region.hexDecode()),r.backup_ws_servers&&r.backup_ws_servers.length>0)for(var i=0;i<r.backup_ws_servers.length;i++){var t=r.backup_ws_servers[i];t&&(r.backup_ws_servers[i]=t.hexDecode())}return S.load(r),x(),r.name&&(e.signin||(e.signin=!0),u.get("rememberChecked",!1)&&u.set("lastLoginName",r.name)),setTimeout(function(){e.wsConnected=!0},1e3),!0}),this.onInvitations=function(r){return e.user.invitations=r,!0},this.onInvitationPage=function(r){return e.user.rewardable_invitation_count=r.rewardable_invitation_count,e.user.invitations_cur_page=r.invitations_cur_page,e.user.invitations_page_rows=r.invitations_page_rows,e.user.invitations_total_pages=r.invitations_total_pages,e.user.invitations_total_rows=r.invitations_total_rows,e.user.invitations=r.invitations,e.user.showInvitations=r.showInvitations,e.user.bind_edu_reward=r.bind_edu_reward,!0},this.onInviteCodeInvitations=function(r){return u.set("selected_invite_code_invitation_data",r),e.user.invite_code_invitations_updated=!0,!0},this.onShowInvitations=function(r){return e.user.showInvitations=r,!0},this.onVIPCards=function(r){return e.user.VIPCards=r,!0},this.onInvoices=function(r){return e.user.invoices=r,e.user.invoices_loading=!1,!0},this.onCoupons=function(r,i){return e.user.coupons=r,e.user.profile.active_coupon_count=i,e.user.coupons_loading=!1,!0},this.setCurrentIP=function(i){if(r.log("setCurrentIP:"+i),i&&""!==i&&i!==e.user.profile.ip){e.user.profile.ip=i;var t={ip:i};return r.log("current-ip-report:"+i),n.emit("current-ip-report",t,function(e){})}},this.onStreamLog=function(r){return e.user.data_user_month=r.data_user_month,e.user.data_user_day=r.data_user_day,e.user.data_session_upload=r.data_session_upload,e.user.data_session_download=r.data_session_download,e.user.speed_upload=r.speed_upload,e.user.speed_download=r.speed_download,e.user.speeds=r.speeds,!0},this.onKickout=function(r){e.user.profile.kicked=!0,e.user.role=p.KICK_OUT,l.signout(),c.signout(),n.signout()},this.onRequestSignin=function(r){e.user.profile.kicked=!0,e.user.role=p.KICK_OUT,l.signout(),c.signout(),n.signout()},this.onKickSessions=function(){e.user.profile.kicked=!0,e.user.role=p.KICK_OUT,x(),l.signout(),c.signout(),n.signout(),d.openKickSessions()},this.recheckin=function(){if(r.log("recheckin"),e.user.role!=p.KICK_OUT){var i,s=u.get("lastServer_scheme",""),o=u.get("lastSignin_api","");return i={platform:m,sid:e.user.profile.sid,user_time:h.milliTime(),name:u.get("n",""),pass:u.get("p",""),ver:v,ip:u.get("ip",""),port:u.get("port",0),lang:t.use(),api:o,secure:!!s.startsWith("https")},n.emit("checkin",i,function(i){return e.$emit("re-checkin-success"),r.log("re-checkin successful")})}},this.onRequestReloadWsServers=function(){return n.emit("reload-ws-servers",{},function(e){return r.log("reload-ws-servers")})},this.recreateClient=function(){n.createClient()},this.checkin=function(r){e.signin=!1,s.link("signin"),n.createClient(r)},this.updateProfile=function(){return h.time(),n.emit("update_profile",null,function(){return r.log("update profile successful")})},this.loadInviteCodeInvitations=function(r){var i={invite_code:r};e.user.invite_code_invitations_updated=!1,n.emit("reload-invite-code-invitations",i,function(e){})},this.reloadInvitationCodes=function(){n.emit("reload-invitation-codes",{},function(r){r&&r.codes&&(e.user.invitation_codes=r.codes,e.user.invite_url_prefix=r.invite_url_prefix,e.user.invite_url_suffix=r.invite_url_suffix,e.user.invite_qrcode_url_prefix=r.invite_qrcode_url_prefix,e.user.invite_qrcode_url_suffix=r.invite_qrcode_url_suffix)})},this.reloadSSSubscription=function(r){var i={secure:r};n.emit("reload-ss-subscription-url",i,function(r){r&&r.url?e.user.ssr_subscription_url=r.url.hexDecode():e.user.ssr_subscription_url="",e.user.ssr_subscription_url_qrcode=r.url_qrcode,r&&r.ss_url?e.user.ss_subscription_url=r.ss_url.hexDecode():e.user.ss_subscription_url="",e.user.ss_subscription_url_qrcode=r.ss_url_qrcode,r&&r.ss2024_url?e.user.ss2024_subscription_url=r.ss2024_url.hexDecode():e.user.ss2024_subscription_url="",e.user.ss2024_subscription_url_qrcode=r.url_ss24_qrcode,r&&r.ssr2024_url?e.user.ssr2024_subscription_url=r.ssr2024_url.hexDecode():e.user.ssr2024_subscription_url="",e.user.ssr2024_subscription_url_qrcode=r.url_ssr24_qrcode,r&&r.client_url?e.user.ss_client_url=r.client_url.hexDecode():e.user.ss_client_url=""})},this.reloadSSSubscriptionAccesses=function(){n.emit("reload-ss-subscription-accesses",{},function(r){if(r&&r.records){for(var i=[],t=0;t<r.records.length;t++){var s=r.records[t];s.ip&&(s.ip=s.ip.hexDecode()),s.ip_region&&(s.ip_region=s.ip_region.hexDecode()),s.user_agent&&(s.user_agent=s.user_agent.hexDecode(),s.user_agent.length>70&&(s.user_agent=s.user_agent.substr(0,30)+"..."+s.user_agent.substr(s.user_agent.length-31,s.user_agent.length))),s.date_time&&(s.date_time=s.date_time.hexDecode()),i.push(s)}e.user.ss_subscription_accesses=i}})},this.reloadV2RSubscription=function(r){var i={secure:r};n.emit("reload-v2r-subscription-url",i,function(r){r&&r.url?e.user.v2r_subscription_url=r.url.hexDecode():e.user.v2r_subscription_url="",e.user.v2r_subscription_url_qrcode=r.url_qrcode,r&&r.ss2024_url?e.user.ss2024_subscription_url=r.ss2024_url.hexDecode():e.user.ss2024_subscription_url="",e.user.ss2024_subscription_url_qrcode=r.url_ss24_qrcode,r&&r.client_url?e.user.v2r_client_url=r.client_url.hexDecode():e.user.v2r_client_url=""})},this.reloadV2RSubscriptionAccesses=function(){n.emit("reload-v2r-subscription-accesses",{},function(r){if(r&&r.records){for(var i=[],t=0;t<r.records.length;t++){var s=r.records[t];s.ip&&(s.ip=s.ip.hexDecode()),s.ip_region&&(s.ip_region=s.ip_region.hexDecode()),s.user_agent&&(s.user_agent=s.user_agent.hexDecode(),s.user_agent.length>70&&(s.user_agent=s.user_agent.substr(0,30)+"..."+s.user_agent.substr(s.user_agent.length-31,s.user_agent.length))),s.date_time&&(s.date_time=s.date_time.hexDecode()),i.push(s)}e.user.v2r_subscription_accesses=i}})},this.reloadClashSubscription=function(r){var i={secure:r};n.emit("reload-clash-subscription-url",i,function(r){r&&r.url?e.user.clash_subscription_url=r.url.hexDecode():e.user.clash_subscription_url="",e.user.clash_subscription_url_qrcode=r.url_qrcode,r&&r.clash2024_url?e.user.clash2024_subscription_url=r.clash2024_url.hexDecode():e.user.clash2024_subscription_url="",e.user.clash2024_subscription_url_qrcode=r.url_clash24_qrcode,r&&r.client_url?e.user.clash_client_url=r.client_url.hexDecode():e.user.clash_client_url=""})},this.reloadClashSubscriptionAccesses=function(){n.emit("reload-clash-subscription-accesses",{},function(r){if(r&&r.records){for(var i=[],t=0;t<r.records.length;t++){var s=r.records[t];s.ip&&(s.ip=s.ip.hexDecode()),s.ip_region&&(s.ip_region=s.ip_region.hexDecode()),s.user_agent&&(s.user_agent=s.user_agent.hexDecode(),s.user_agent.length>70&&(s.user_agent=s.user_agent.substr(0,30)+"..."+s.user_agent.substr(s.user_agent.length-31,s.user_agent.length))),s.date_time&&(s.date_time=s.date_time.hexDecode()),i.push(s)}e.user.clash_subscription_accesses=i}})},this.isGuest=function(){return e.user.role===p.GUEST},this.isVIP=function(){return e.user.role===p.VIP},this.isOverDue24=function(){if(e.user.profile.until&&(new Date).getTime()-(e.user.profile.vip_duration+e.user.profile.sys_time)>36e5)return!0;return!1},this.markNotificationReaded=function(){_.every(e.user.notifications,function(e){e.readed=!0});n.emit("mark-notification-readed",{},function(e){})},this.markNotificationHided=function(r,i){i&&(e.user.notifications=_.without(e.user.notifications,_.findWhere(e.user.notifications,{_id:r})));var t={notification_id:r,hide:i};n.emit("mark-notification-hided",t,function(e){})},this.markNotificationThumbup=function(r,i){var t,s;for(t=0;t<e.user.notifications.length;t++)if((s=e.user.notifications[t])._id===r){s.thumbup=!s.thumbup,s.thumbdown=!1;break}if(s){var o={notification_id:r,thumbup:s.thumbup,thumbdown:s.thumbdown};n.emit("mark-notification-thumbup_down",o,function(e){})}},this.markNotificationThumbdown=function(r,i){var t,s;for(t=0;t<e.user.notifications.length;t++)if((s=e.user.notifications[t])._id===r){s.thumbdown=!s.thumbdown,s.thumbup=!1;break}if(s){var o={notification_id:r,thumbup:s.thumbup,thumbdown:s.thumbdown};n.emit("mark-notification-thumbup_down",o,function(e){})}},this.reloadNotifications=function(){var r={lang:t.use()};n.emit("reload-notifications",r,function(r){e.user.profile.notification_count=_.reduce(r.total_notifications,function(e,r){return r.hided||r.readed?e:e+1},0),r.notifications&&r.notifications.length>0?e.user.notifications=r.notifications:e.user.notifications=[]})},this.reloadWheat=function(r,i){var t;t=r?{wheat:r,ready:!0}:{},n.emit("reload-wheat",t,function(r){if(e.user.total_wheat=r.total_wheat?r.total_wheat:0,r.last_wheat_action_time?e.user.last_wheat_action_time=r.last_wheat_action_time:e.user.last_wheat_action_time=(new Date).getTime(),r.wheats&&r.wheats.length>0){for(var i=-1,t=!1,s=0;s<r.wheats.length;s++){var o=r.wheats[s];o.status===f.READY&&(t=!0),o.status===f.UNFETCHED&&-1==i&&(i=s)}t||-1==i||(r.wheats[i].status=f.WAITING),e.user.wheats=r.wheats}else e.user.wheats=[]})},this.reloadExchangeWheat=function(){n.emit("reload-exchangable-wheat",{},function(r){r&&r.exchangable_wheat&&(e.user.exchangable_wheat=r.exchangable_wheat,e.user.profile.exchangable_wheat_score=r.exchangable_wheat.exchangable_wheat_score)})},this.exchangeWheat=function(r){var i={num:r};n.emit("exchange-wheat",i,function(r){r&&r.exchangable_wheat&&(e.user.exchangable_wheat=r.exchangable_wheat,e.user.profile.exchangable_wheat_score=r.exchangable_wheat.exchangable_wheat_score,e.user.profile.active_invitation_code_count=r.active_invitation_code_count)})},this.fetchWheat=function(r){var i;if(e.user.wheats)for(i=0;i<e.user.wheats.length;i++){var t=e.user.wheats[i];if(t._id===r&&t.status===f.READY){t.status=f.FETCHING;var s={wheat:t._id};n.emit("fetch-wheat",s,function(e){});break}}},this.setFetchServersError=function(r){e.user.error.fetch_error_servers=r},this.bindEmail=function(r){var i;return e.user.error.emailBind_error_succ=!1,e.user.error.emailBind_error_user=!1,e.user.error.emailBind_error_exists=!1,e.user.error.emailBind_error_email=!1,e.user.error.emailBind_error_email_edu=!1,i={email:r.email},n.emit("bind_email",i,function(r){r.error?"user"===r.error?e.user.error.emailBind_error_user=!0:"exists"===r.error?e.user.error.emailBind_error_exists=!0:"email"===r.error?e.user.error.emailBind_error_email=!0:"email_edu"===r.error&&(e.user.error.emailBind_error_email_edu=!0):(e.user.error.emailBind_error_succ=!0,e.user.profile.email=r.email,e.user.profile.emailBinded=!0)})},this.setInviter=function(r){var i;return i={inviter:r.inviter},e.user.error.inviter_error_succ=!1,e.user.error.inviter_error_inviter=!1,e.user.error.inviter_error_inviter_exist=!1,n.emit("set_inviter",i,function(r){r.error?"inviter"===r.error?e.user.error.inviter_error_inviter=!0:"inviter_exist"===r.error&&(e.user.error.inviter_error_inviter_exist=!0):(e.user.profile.inviter=r.inviter,e.user.error.inviter_error_succ=!0)})},this.resendBindEmailVerification=function(e){var r={email:e};return n.emit("resend-bindemail-verification",r,function(e){})},this.fetchInvitationReward=function(r){var i={invitation_id:r};return e.user.error.fetch_error_invitation=!1,e.user.error.fetch_error_status=!1,e.user.error.fetch_error_succ=!1,n.emit("fetch-invitation-reward",i,function(r){r.error?"invitation"===r.error?e.user.error.fetch_error_invitation=!0:"status"===r.error&&(e.user.error.fetch_error_status=!0):e.user.error.fetch_error_succ=!0})},this.deleteExpiredInvitation=function(r){var i={invitation_id:r};return e.user.error.delete_error_invitation=!1,e.user.error.delete_error_invitation_status=!1,e.user.error.delete_error_invitation_succ=!1,n.emit("delete-expired-invitation",i,function(r){r.error?"invitation"===r.error?e.user.error.delete_error_invitation=!0:"status"===r.error&&(e.user.error.delete_error_invitation_status=!0):e.user.error.delete_error_invitation_succ=!0})},this.submitReasonableSuggestion=function(r,i){e.user.error.submit_reasonable_suggesion_error=!1,e.user.error.submit_reasonable_suggesion_succ=!1;var t={subject:r,content:i,sid:e.user.profile.sid,uid:e.user.profile.uid};return n.emit("submit-reasonable-suggesion",t,function(r){r.error?e.user.error.submit_reasonable_suggesion_error=!0:e.user.error.submit_reasonable_suggesion_succ=!0})},this.viewVIPCodeDetails=function(r,i){e.user.error.view_vipcode_details_succ=!1,e.user.error.view_vipcode_details_fail=!1;var t={code:r,lang:i,sid:e.user.profile.sid,uid:e.user.profile.uid};return n.emit("view-vipcode-details",t,function(e){})},this.onVIPCodes=function(r){if(r){if(e.user.vipcodes_loading=!1,r.error)return e.user.error.load_vipcodes_succ=!0,void(e.user.error.load_vipcodes_fail=!0);if(e.user.error.load_vipcodes_succ=!0,r.codes){var i=JSON.stringify(r.codes);e.user.vipcodes=i}return!0}},this.onVIPCodeDetails=function(r){if(r){if(r.error)return e.user.error.view_vipcode_details_succ=!0,void(e.user.error.view_vipcode_details_fail=!0);if(e.user.error.view_vipcode_details_succ=!0,r.details){var i=JSON.stringify(r.details);console.log("details:"+i),e.user.curr_vipcode_details_str=i}return!0}},this.redeemVIPCode=function(r,i,t){e.user.error.redeem_vipcode_succ=!1,e.user.error.redeem_vipcode_fail=!1;var s={code:r,pass:a.md5(i),lang:t,sid:e.user.profile.sid,uid:e.user.profile.uid};return n.emit("redeem-vipcode",s,function(e){})},this.onRedeemVIPCode=function(r){if(r)return r.error?(e.user.error.redeem_vipcode_succ=!0,void(e.user.error.redeem_vipcode_fail=!0)):(e.user.error.redeem_vipcode_succ=!0,r.status&&(console.log("onRedeemVIPCode status:"+r.status),e.user.redeem_vipcode_result=r.status),!0)},this.submitInviteEmailDraft=function(r,i,t){e.user.error.submit_invite_email_draft_error=!1,e.user.error.submit_invite_email_draft_succ=!1;var s={email:r,subject:i,content:t,sid:e.user.profile.sid,uid:e.user.profile.uid};return n.emit("submit-invite-email-draft",s,function(r){r.error?e.user.error.submit_invite_email_draft_error=!0:e.user.error.submit_invite_email_draft_succ=!0})},this.submitQRCodeEmail=function(r){e.user.error.submit_qrcode_email_error=!1,e.user.error.submit_qrcode_email_succ=!1;var i={email:r,sid:e.user.profile.sid,uid:e.user.profile.uid};return n.emit("submit-qrcode-email",i,function(r){r.error?e.user.error.submit_qrcode_email_error=!0:e.user.error.submit_qrcode_email_succ=!0})},this.changePassword=function(e){var r;return r={old_pass:e.old_pass,new_pass:e.new_pass},n.emit("change_password",r,function(e){e.error&&("OLD_PASS"===e.error||e.error)})},this.clear=function(){e.user=angular.copy(w)},this.logout_=function(){this.beforeSignout(),this.clear(),e.$emit("logout"),l.signout(),c.signout(),n.signout()},this.logout=function(r){return function(){r.beforeSignout(),r.clear(),e.$emit("logout"),c.signout(),l.signout(),n.signout()}}(this),b=function(){e.$watch("user",function(){return x()},!0)},this.init=function(i){return function(){return e.user=angular.copy(w),u.get("user")?(i.load(u.get("user")),x(),u.remove("user")):u.get("profile")&&i.load(u.get("profile")),e.vip_duration=u.get("vip_duration",0),b(),s.link("user"),s.link("vip_duration"),e.wsConnected=!1,s.link("wsConnected"),e.user.invoices_loading=!1,e.user.coupons_loading=!1,e.user.vipcodes_loading=!1,r.info("userManager Ready!")}}(this),o.registerService("userManager",this,["logout","checkin","load","setSid","load_invitations","loadVipCards","loadInvoices","loadCoupons","reloadVIPCodes","submitReasonableSuggestion","submitInviteEmailDraft","submitQRCodeEmail","fetchInvitationReward","deleteExpiredInvitation","resendBindEmailVerification","changePassword","bindEmail","setInviter","clear","updateProfile","fetchWheat","reloadWheat","reloadExchangeWheat","reloadNotifications","markNotificationReaded","markNotificationHided","markNotificationThumbup","markNotificationThumbdown","exchangeWheat","reloadInvitationCodes","loadInviteCodeInvitations","reloadSSSubscription","reloadSSSubscriptionAccesses","reloadV2RSubscription","reloadV2RSubscriptionAccesses","reloadClashSubscription","reloadClashSubscriptionAccesses","viewVIPCodeDetails","redeemVIPCode"]),this},define(["../app","./server","./teleScope","./teleMethod","./domainManager","./proxyManager","./pageManager","./storage","./generate","./timeUtils"],function(r){return r.service("userManager",["$rootScope","$log","$injector","$translate","teleScope","teleMethod","server","storage","generate","domainManager","proxyManager","pageManager","timeUtils","ROLES","WHEAT_STATUS","VER","SERVER","PLATFORM",e])})}).call(this);