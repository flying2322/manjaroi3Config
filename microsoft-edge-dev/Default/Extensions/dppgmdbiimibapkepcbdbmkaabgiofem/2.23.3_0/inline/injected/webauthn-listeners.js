"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3a9b6987-2ef4-50ff-aa56-3fd2f724d7b6")}catch(e){}}();
(()=>{var m=e=>{throw new Error("Unexpected value.")},P=()=>globalThis.crypto.getRandomValues(new Uint32Array(1))[0].toString(36),u=()=>{let e,t=new Promise(n=>{e=n});return{resolve:n=>e(n),promise:t}};var w=e=>{if(!e)return A();if(e.aborted)return Promise.resolve({type:"aborted"});let t=u(),r=()=>{t.resolve({type:"aborted"}),e.removeEventListener("abort",r)};return e.addEventListener("abort",r),t.promise},b=e=>!(typeof e!="string"||e.length===0),R=e=>e instanceof ArrayBuffer||e instanceof window.ArrayBuffer||e instanceof Uint8Array||e instanceof window.Uint8Array||e instanceof DataView||e instanceof window.DataView||e instanceof Array||e instanceof window.Array?Array.from(e instanceof ArrayBuffer||e instanceof window.ArrayBuffer?new Uint8Array(e):e):e,x=e=>new Promise(t=>{setTimeout(()=>t({type:"timeout"}),e)}),A=()=>new Promise(()=>{});function O(){if(typeof globalThis.exportFunction=="function")return globalThis.exportFunction}function S(){if(typeof globalThis.cloneInto=="function")return globalThis.cloneInto}function T(){if(window.wrappedJSObject)return window.wrappedJSObject}function v(e){let t=S();return t?t(e,window,{cloneFunctions:!0,wrapReflectors:!0}):e}function p(e){let t=S();return t?new window.Promise((r,n)=>{e.then(o=>{r(t(o,window,{cloneFunctions:!0,wrapReflectors:!0}))}).catch(o=>{n(o)})}):e}var a=class e{constructor(t){this.send=async(t,{body:r,signal:n})=>{let o=P(),s=await this.handleOutgoingSyn(o,t,n);if(s.type!=="ack")return s;let d=s.data;return(await this.handleOutgoingDirect(d.ackedById,o,t,r,n)).data};this.getRoutes=()=>Object.keys(this.routes);this.handleOutgoingSyn=async(t,r,n)=>{let o=w(n),s={msgId:t,source:this.source,type:e.opSynType,message:void 0,name:r};this.log.debug("starting request sequence",r);let d=u();this.synRequests[t]=d,window.postMessage(s),this.log.debug("starting ack race",r);let i=await Promise.race([d.promise,x(1e3),o]);if(i.type==="timeout")return this.log.debug("finished request sequence: ack timed out",r),delete this.synRequests[t],{type:e.NoReceivingEnd};if(i.type==="aborted"||n?.aborted)return this.log.debug("finished request sequence: aborted sync",r),delete this.synRequests[t],this.throwAbort(n);this.log.debug(`ack race won by: ${i.data.ackedById}`,r);let c=u();return this.directRequests[t]=c,i};this.handleIncomingSyn=async t=>{if(!this.routes[t.name]){this.log.debug("received a request with no handler to call",t.name);return}let n={msgId:t.msgId,source:this.source,destination:t.source,name:t.name,type:e.opSynAckType,message:void 0};window.postMessage(n)};this.handleIncomingSynAck=t=>{if(typeof this.synRequests[t.msgId]>"u")return;this.synRequests[t.msgId].resolve({type:"ack",data:{ackedById:t.source}}),delete this.synRequests[t.msgId]};this.handleOutgoingDirect=async(t,r,n,o,s)=>{let d=w(s),i=u();this.directRequests[r]=i;let c={msgId:r,source:this.source,destination:t,type:e.opDirectRequestType,message:o,name:n};this.log.debug(`sending direct request to: ${t}`,n),window.postMessage(c);let f=await Promise.race([i.promise,d]);if(delete this.directRequests[r],f.type==="aborted"){let q={...c,type:e.opAbortType};return q.reason=s?.reason,this.log.debug("notifying receiver to abort",n),window.postMessage(q),this.log.debug("finished request sequence: aborted",n),this.throwAbort(s)}return this.log.debug("finished request sequence: success",n),f};this.handleIncomingDirectRequest=async t=>{let r=this.routes[t.name];if(!r){this.log.error("received a request with no handler to call",t.name);return}let n=new AbortController;this.abortableRequests[t.msgId]=n;let o=w(n.signal),s;try{s=await Promise.race([r({body:t.message,signal:n.signal}),o])}catch(c){let f=c instanceof Error?c.message:"unknown";s={type:e.HandlerError,data:{reason:f}}}delete this.abortableRequests[t.msgId];let d=s;if(d&&d?.type==="aborted")return;let i={msgId:t.msgId,source:this.source,destination:t.source,name:t.name,type:e.opDirectResponseType,message:s};window.postMessage(i)};this.handleIncomingAbortRequest=t=>{if(typeof this.abortableRequests[t.msgId]>"u"){this.log.debug(`received abort ${t.msgId} for no active request - likely already completed`,t.name);return}this.abortableRequests[t.msgId].abort(t.reason),delete this.abortableRequests[t.msgId]};this.handleIncomingResponse=t=>{if(typeof this.directRequests[t.msgId]>"u"){this.log.debug(`received response ${t.msgId} with no promise to resolve - likely already aborted`,t.name);return}this.directRequests[t.msgId].resolve({type:"completed",data:t.message}),delete this.directRequests[t.msgId]};this.throwAbort=t=>{throw t?.reason?new DOMException(t?.reason,"AbortError"):new DOMException("signal is aborted without reason","AbortError")};this.validateMessage=t=>{let r="validate";if(typeof t!="object"||t===null)return this.log.debug("invalid message - not an object",r),!1;let n=t;return b(n.msgId)?b(n.source)?b(n.name)?n.type!==e.opSynType&&n.type!==e.opSynAckType&&n.type!==e.opAbortType&&n.type!==e.opDirectRequestType&&n.type!==e.opDirectResponseType?(this.log.debug("invalid message: type unsupported",r),!1):!0:(this.log.debug("invalid message - missing name",r),!1):(this.log.debug("invalid message - missing source",r),!1):(this.log.debug("invalid message - missing msgId",r),!1)};this.routes=t,this.synRequests={},this.abortableRequests={},this.directRequests={},this.source=P(),this.debug=!1,this.log={error:(r,n)=>console.error(`PWM-${this.source}-${n}: ${r}`),debug:(r,n)=>{this.debug&&console.info(`PWM-${this.source}-${n}: ${r}`)}},window.addEventListener("message",r=>{if(!this.validateMessage(r.data))return;let o=r.data;if(o.source===this.source||o.destination&&o.destination!==this.source)return;let{type:s}=o;s===e.opSynType&&this.handleIncomingSyn(o),s===e.opSynAckType&&this.handleIncomingSynAck(o),s===e.opAbortType&&this.handleIncomingAbortRequest(o),s===e.opDirectRequestType&&this.handleIncomingDirectRequest(o),s===e.opDirectResponseType&&this.handleIncomingResponse(o)})}static{this.opSynType="op-window-syn"}static{this.opSynAckType="op-window-syn-ack"}static{this.opAbortType="op-window-abort"}static{this.opDirectRequestType="op-window-direct-request"}static{this.opDirectResponseType="op-window-direct-response"}static{this.NoReceivingEnd="no-receiving-end"}static{this.HandlerError="uncaught-handler-error"}};var l=window.navigator?.credentials?.get.bind(window.navigator.credentials),y=window.navigator?.credentials?.create.bind(window.navigator.credentials),I=window.PublicKeyCredential?.isConditionalMediationAvailable?.bind(window.PublicKeyCredential),E=window.PublicKeyCredential?.isUserVerifyingPlatformAuthenticatorAvailable?.bind(window.PublicKeyCredential),N,B=new Promise(e=>{let t=()=>{N=!0,e(void 0)};window.document.prerendering?document.addEventListener("prerenderingchange",t):t()}),K=async e=>{let t={...e};delete t?.signal,t.mediation==="conditional"&&t.publicKey?.timeout&&(t.publicKey.timeout=void 0);let r={type:"get-credential-request",data:JSON.stringify(t,(o,s)=>R(s))},n=await C.send("get-credential",{body:r});if(n.type===a.NoReceivingEnd||n.type===a.HandlerError)return l(e);if(n.type==="get-credential-error"){if(n.data.reason==="timeout")throw new DOMException("The operation either timed out or was not allowed. See https://www.w3.org/TR/webauthn-2/#sctn-privacy-considerations-client.","NotAllowedError");if(t.mediation==="conditional"&&n.data.reason==="user-cancelled")return A();if(t.mediation==="conditional"&&n.data.reason==="fallback-requested"){let o={...e};return delete o.mediation,l(o)}return n.data.reason==="user-cancelled"?null:(n.data.reason==="fallback-requested"||n.data.reason==="internal-error"||n.data.reason==="invalid-request"||m(n.data.reason),l(e))}return H(n)},H=({data:e})=>{let t={clientDataJSON:new Uint8Array(e.response.clientDataJSON).buffer,authenticatorData:new Uint8Array(e.response.authenticatorData).buffer,signature:new Uint8Array(e.response.signature).buffer,userHandle:e.response.userHandle?new Uint8Array(e.response.userHandle).buffer:null};Object.setPrototypeOf(t,AuthenticatorAssertionResponse.prototype);let r={id:e.id,rawId:new Uint8Array(e.rawId).buffer,type:e.type,authenticatorAttachment:e.authenticatorAttachment??null,response:t,getClientExtensionResults:()=>v(e.clientExtensionResults??{})};return Object.setPrototypeOf(r,PublicKeyCredential.prototype),r},j=async e=>{let t={...e};delete t?.signal;let r={type:"create-credential-request",data:JSON.stringify(t,(o,s)=>R(s))},n=await C.send("create-credential",{body:r});if(n.type===a.NoReceivingEnd||n.type===a.HandlerError)return y(e);if(n.type==="create-credential-error"){if(n.data.reason==="timeout")throw new DOMException("The operation either timed out or was not allowed. See https://www.w3.org/TR/webauthn-2/#sctn-privacy-considerations-client.","NotAllowedError");if(n.data.reason==="duplicate")throw new DOMException("The user attempted to register an authenticator that contains one of the credentials already registered with the relying party.","InvalidStateError");return n.data.reason==="user-cancelled"?null:(n.data.reason==="fallback-requested"||n.data.reason==="internal-error"||n.data.reason==="invalid-request"||m(n.data.reason),y(e))}return F(n)},F=({data:e})=>{let t={attestationObject:new Uint8Array(e.response.attestationObject).buffer,clientDataJSON:new Uint8Array(e.response.clientDataJSON).buffer,getTransports:()=>e.response.transports??[],getAuthenticatorData:()=>new Uint8Array(e.response.authenticatorData??[]).buffer,getPublicKey:()=>e.response.publicKey?new Uint8Array(e.response.publicKey).buffer:null,getPublicKeyAlgorithm:()=>e.response.publicKeyAlgorithm};Object.setPrototypeOf(t,AuthenticatorAttestationResponse.prototype);let r={id:e.id,rawId:new Uint8Array(e.rawId).buffer,type:e.type,authenticatorAttachment:e.authenticatorAttachment??null,response:t,getClientExtensionResults:()=>v(e.clientExtensionResults??{})};return Object.setPrototypeOf(r,PublicKeyCredential.prototype),r},h,G=async()=>{let e={type:"should-intercept-webauthn-request",data:void 0},t=await C.send("should-intercept-webauthn",{body:e});return t.type===a.NoReceivingEnd||t.type===a.HandlerError||t.type==="should-intercept-webauthn-error"?!1:t.data},V=async e=>{typeof e.body.authenticatePasskeys<"u"&&(h=e.body.authenticatePasskeys)},C=new a({"update-settings":V}),g=async()=>(typeof N>"u"&&await B,typeof h>"u"&&(h=await G()),h);async function M(e){if(!await g()){if(y)return y(e);throw new DOMException("The operation either timed out or was not allowed. See https://www.w3.org/TR/webauthn-2/#sctn-privacy-considerations-client.","NotAllowedError")}return j(e)}async function k(e){if(!await g()){if(l)return l(e);throw new DOMException("The operation either timed out or was not allowed. See https://www.w3.org/TR/webauthn-2/#sctn-privacy-considerations-client.","NotAllowedError")}return K(e)}async function D(){return await g()?!0:I?I():!1}async function W(){return await g()?!0:E?E():!1}var U=()=>{let e=O();e?(e(t=>p(M(t)),window.navigator.credentials,{defineAs:"create"}),e(t=>p(k(t)),window.navigator.credentials,{defineAs:"get"}),e(()=>p(D()),window.PublicKeyCredential,{defineAs:"isConditionalMediationAvailable"}),e(()=>p(W()),window.PublicKeyCredential,{defineAs:"isUserVerifyingPlatformAuthenticatorAvailable"})):(window.navigator.credentials.create=M,window.navigator.credentials.get=k,window.PublicKeyCredential.isConditionalMediationAvailable=D,window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=W)},$=()=>{if(window.navigator.credentials.create.length>0&&window.navigator.credentials.get.length>0)return;let e=T();e&&e.navigator.credentials.create.length>0&&e.navigator.credentials.get.length>0||U()};function J(){window.navigator.credentials&&(g(),U(),setInterval($,100))}J();})();

//# debugId=3a9b6987-2ef4-50ff-aa56-3fd2f724d7b6
