function NRTitleBar(){let e=this;function t(){"complete"===document.readyState?e.injectTitleBar():document.onreadystatechange=function(){"complete"===document.readyState&&e.injectTitleBar()}}function n(t,n){return new Promise(((a,r)=>{let l;if(!t){let e=n.match(/\.([^.]+)$/);e&&(t=e[1])}t||(t="js");const i="nr-ext-"+n;n=chrome.runtime.getURL(n),"css"===t?(l=document.createElement("link"),l.id=i,l.type="text/css",l.rel="stylesheet",l.href=n,l.onload=()=>{n.includes("nr-ext-title-bar.css")&&(e.capsule.style.display="inline-block")},e.shadow.appendChild(l),a()):"js"===t?(l=document.createElement("script"),l.id=i,fetch(n).then((e=>e.text())).then((t=>{l.textContent=t,e.shadow.appendChild(l),a()})).catch((e=>{a()}))):a()})).catch((e=>{}))}e.capsule=null,e.shadow=null,e.isInit=!1,e.docType=docType,e.injectTitleBar=function(){if(!document.getElementById("nr-ext-title-bar-capsule"))try{return new Promise((t=>{fetch(chrome.runtime.getURL("injected/nr-ext-title-bar/nr-ext-title-bar.html")).then((e=>e.text())).then((t=>new Promise((async a=>{let r=await async function(t){try{e.capsule=document.createElement("DIV"),e.capsule.id="nr-ext-title-bar-capsule",e.capsule.style.width=0,e.capsule.style.height=0,e.capsule.style.left=0,e.capsule.style.bottom=0,e.capsule.style.display="none",e.shadow=e.capsule.attachShadow({mode:"open"}),await async function(){try{await n(null,"injected/nr-ext-title-bar/nr-ext-title-bar.css")}catch(e){}}();const a=document.createElement("DIV");a.innerHTML=t;const r=[];document.getElementsByTagName("body")[0];for(;a.children.length>0;)r.push(a.children[0]),e.shadow.appendChild(a.children[0]);let l=Array.from(document.getElementsByTagName("h1"))[0];if(l){l.prepend(e.capsule),e.capsule.style.width="min-content",e.capsule.style.height="19px",e.capsule.style.paddingRight="5px",e.capsule.style.verticalAlign="middle";let t=window.getComputedStyle(l).color;return e.shadow.getElementById("nr-ext-quick-play").style.color=t,e.shadow.getElementById("ext-title-bar-label").style.color=t,!0}return!1}catch(e){}}(t);a(r)})))).then((async t=>{t&&await async function(){try{await n(null,chrome.runtime.getURL("injected/nr-ext-reading-bar/nr-ext-reading-bar.css")),chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(function(t){let n=t.theme;"system"===n&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),e.shadow.getElementById("nr-ext-title-bar-container").setAttribute("ext-theme",n)}));let t=Array.from(document.getElementsByTagName("h1"))[0];if(t){let n=t.parentElement.innerText.length;chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(t=>{var a,r;e.shadow.getElementById("ext-title-bar-label").innerText=(r=Math.round(n/(a=t.speed,isNaN(a)&&(a=parseInt(a)),a/180*5)),Math.ceil(r/60)+" min ")}))}e.shadow.getElementById("nr-ext-quick-play").onclick=()=>{"undefined"!=typeof readingBar?utils.tabId!==nrDomController.beingReadTabId?chrome.runtime.sendMessage({fn:"stopBeingReadTab"},(()=>{chrome.runtime.lastError,readingBar.readBtnOnClick()})):readingBar.readBtnOnClick():chrome.runtime.sendMessage({message:"injectReadingBarAndRead"})}}catch(e){}}()})).catch((e=>{})),t()}))}catch(e){}},e.getHasTitleBar=function(e,t,n){n(!!document.getElementById("nr-ext-title-bar-capsule"))},e.resetTitleBar=function(){const t=document.getElementById("nr-ext-title-bar-capsule");t&&t.remove();e.isInit=!1},e.injectTitleBarHelper=t,e.asyncFunctions=["getHasTitleBar"],e.showTimer=null,e.hideTimer=null,t(),chrome.runtime.onMessage.addListener((function(t,n,a){e[t.fn]&&e[t.fn](t,n,a)}))}var nrTitleBar=nrTitleBar||new NRTitleBar;