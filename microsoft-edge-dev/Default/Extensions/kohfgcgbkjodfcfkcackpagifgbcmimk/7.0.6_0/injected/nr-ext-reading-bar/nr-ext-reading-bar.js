function NRExtReadingBar(){let e=this;e.capsule=null,e.shadow=null,e.prevPos={top:null,right:null},displace=window.displacejs,e.hasReadingBar=!1,e.isVoicesInit=!1,e.mode="max",e.theme="light",e.systemTheme="light",e.isAutoSelectVoice=!1,e.isImmersive=!1,e.isImmersiveTextSpacing=!1,e.immersiveTextSize=1,e.isInjectingReadingBar=!1,e.showOnboard=!1,e.isSavingToMobile=!1,e.isAsyncFunction=function(t){return e.asyncFunctions.includes(t)},e.asyncFunctions=["getHasTextProcessor","getHasReadingBar","injectReadingBar"],e.getHasTextProcessor=function(e,t,n){try{return void 0===nrTextProcessor?n(!1):n(!0),!0}catch(e){return n(!1),!0}},e.getHasReadingBar=function(t,n,i){i(e.hasReadingBar)},e.injectReadingBar=Te,e.setReadingBarSetting=w,e.updateReadingBarSetting=function(t,n,i){e.settings=t.settings},e.setReadingBarVisibility=Be,e.setReadingBarUI=r,e.setUIVoiceList=x,e.toggleReadingBar=ke,e.voicesOnLoad=function(t,n,i){e.settings.freeVoice=e.settings.freeVoice?e.settings.freeVoice:voices.defaultFreeVoice,e.settings.premVoice=e.settings.premVoice?e.settings.premVoice:voices.defaultPremVoice,e.settings.plusVoice=e.settings.plusVoice?e.settings.plusVoice:voices.defaultPlusVoice,e.settings.preset1Voice=e.settings.preset1Voice?e.settings.preset1Voice:voices.defaultPremVoice,e.settings.preset2Voice=e.settings.preset2Voice?e.settings.preset2Voice:voices.defaultPremVoice,e.settings.preferredVoicesByLang=0===Object.keys(e.settings.preferredVoicesByLang).length?voices.preferredVoicesByLang:e.settings.preferredVoicesByLang,voices.preferredVoicesByLang=e.settings.preferredVoicesByLang,e.isVoicesInit||u()},e.updateVoice=h,e.getReadingBarElements=function(){return readingBarElements},e.setPresetAsSelectedVoice=function(t,n,i){const s=t.index;w("selectedVoice",e.settings["preset"+s+"Voice"]),h()},e.setToggle=ce,e.setDyslexia=ie,e.updateNumPages=function(){e.isInjectingReadingBar||(e.immersiveTotalPages.innerText=doc.getNumPages(),$e())},e.toggleImmersive=je,e.setImmersiveTexts=function(){if(Ke(),"googleDoc"==doc.type||"googleDrivePreview"==doc.type||!doc.parseForConvertToPdf)return Promise.resolve().then((()=>{if("googleDoc"!=doc.type)return function(){const t=nrTextProcessor.textsToRead,n=doc.getCurrentIndex();for(let i=0;i<t.length;i++){sentenceId="nr-immersive-s"+i;const s=document.createElement("P"),o=document.createElement("nr-sentence"),r=document.createTextNode(t[i]);o.classList.add(sentenceId),o.id=sentenceId,o.setAttribute("page",n),o.appendChild(r),s.appendChild(o),nrDomController.bindClickToReadEventsForImmersiveReader(o),e.immersiveTextContainer.appendChild(s)}}();doc.parsePageForImmersiveReader().then((function(e){return Ye(e)}))})).then((()=>{Je(),e.immersiveTotalPages.innerText=doc.getNumPages(),e.immersiveCurrentPageInput.value=doc.getPageIndex(),e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",$e()})).catch((e=>{}));doc.parseForConvertToPdf().then((function(e){return Ye(e)})).then((()=>{Je(),e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",$e()})).catch((e=>{}))},e.setImmersiveNotReadTextClass=oe,e.showRelocateButton=function(){"googleDrivePreview"!==doc.type&&"max"===e.mode&&"selection-context-menu"!=reader.readOption&&(e.relocateBtn.style.display="block")},e.hideRelocateButton=ne,e.readSelection=ee,e.setCCText=Ue,e.toggleCC=de,e.initTooltip=function(t,n,i){const s=e.shadow.getElementById(t.id+"Tooltip");if(s)return void(s.style.display="none");let o=function(e,t,n){let i=document.createElement("span");n.length>20&&i.classList.add("tooltip");return i.id=e.id+"Tooltip",i.classList.add(t+"Tooltip"),i.style.display="none",i.innerHTML=n,e.appendChild(i),i}(t,n,i);t.onmouseenter=function(){"nr-ext-btn-relocate"===t.id&&"min"===e.mode||(o.style.display="block")},t.onmouseleave=function(){o.style.display="none"},o.onmouseenter=function(){o.style.display="none"}},e.readBtnOnClick=X,e.setUIOnLoading=he,e.setUIOnPause=xe,e.setUIOnPlay=ve,e.readerOnPlay=function(){ve(),Re(reader.currReadIndex,!0),function(t){if(!e.indexToProgressTime[t]||!e.indexToProgressTime[t+1])return;const n=e.indexToProgressTime[t].seconds;e.indexToProgressTime[t+1].seconds;let i=n;e.progressTimeIncrementor&&(clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null);e.progressTimeIncrementor=setInterval((()=>{i++,e.progressTimeCurr.innerText=Fe(i)}),1e3)}(reader.currReadIndex),("kindle"===doc.type||"googleDoc"===doc.type)&&(Ue(ttsText.textsForTts[reader.currReadIndex].processed,reader.currReadIndex),e.isCC?de(!0):de(!1))},e.readerOnPause=ye,e.readerOnLoading=be,e.readerOnStop=function(){fe()},e.textsToReadOnChange=function(){De(ttsText.textsForTts)},e.defaultEmail="user@naturalreaders.com",e.freeUserText="Free User",e.premUserText="Premium User",e.plusUserText="Plus User",e.eduPremUserText="Edu Premium Group User",e.freeEduPremUserText="Free Edu Premium Group User",e.eduPremUserExpiredText="Edu Premium Group User (Expired)",e.loadingTimer=null,e.voiceType="prem",e.progressTimeIncrementor=null,e.isBeingDragged=!1,e.inactivityTimeout=null,e.messageType="signup",e.messageTime=null,e.messageFirstDay=null,e.rateMessageTime=null,e.isShowMobileMessage=!0,e.isShowRateMessage=!0,e.isShowSignupMessage=!0,e.messageIndex=0;let t={ext:"nr-ext",container:"nr-ext-container",exitBtn:"nr-ext-exit",dragHandle:"nr-ext-drag",readBtn:"nr-ext-play",forwardBtn:"nr-ext-forward",backwardBtn:"nr-ext-rewind",clickToReadToggle:"nr-ext-click-to-read-toggle",peBtn:"nr-ext-pe",helpBtn:"nr-ext-settings-help",convertBtn:"nr-ext-mp3",ccToggle:"nr-ext-cc-toggle",autoScrollToggle:"nr-ext-autoscroll-toggle",loginBtn:"nr-ext-account-login",logoutBtn:"nr-ext-account-logout",signupBtn:"nr-ext-account-signup",billingBtn:"nr-ext-account-billing",emailUI:"nr-ext-account-info",loginUI:"nr-ext-account-actions",userEmail:"nr-ext-account-email",onboard:"nr-ext-onboard",onboardLogin:"nr-ext-onboard-login",onboardSignup:"nr-ext-onboard-signup",onboardLanguageList:"nr_ext_onboard_languages",onboardVoicePrevBtn:"nr-ext-onboard-voice-prev",onboardVoiceNextBtn:"nr-ext-onboard-voice-next",onboardVoiceList:"nr-ext-onboard-voice-list",voiceMenu:"nr-ext-voice-menu",voiceMenuBtn:"nr-ext-voice-trigger",voiceMenuCloseBtn:"nr-ext-voice-close",voiceSearchBtn:"nr-ext-voice-search",voiceSearchClose:"nr-ext-voice-search-close",voiceSearchInput:"nr-ext-input-search",voiceActions:"nr-ext-voice-actions",voiceChips:"nr-ext-voices-chips",voiceList:"nr-ext-voice-list",voiceListMapper:"nr-ext-voice-list-mapper",languageList:"nr-ext-language",voiceIcon:"nr-ext-voice-icon",preset1VoiceList:"nr-ext-preset1-voice",preset2VoiceList:"nr-ext-preset2-voice",readIcon:"nr-ext-read-icon-toggle",highlightTypeMenu:"nr-ext-highlight-type-menu",highlightColourMenu:"nr-ext-highlight-color-menu",highlightPreview:"nr-ext-highlight-preview",autoSelectVoiceToggle:"nr-ext-auto-select-voice",resetBtn:"nr-ext-reset",selectableCharLimit:"nr-ext-rs-char-limit",hotkeysBtn:"nr-ext-hotkey-trigger",hotkeyClose:"nr-ext-hotkeys-close",hotkeyBack:"nr-ext-hotkeys-back",hotkeyEditBtn:"nr-ext-settings-hotkey",hotkeyActivateText:"nr-ext-hotkey-activate-text",speedSlider:"nr-ext-speed-slider",speedText:"nr-ext-speed-text",speedSubBtn:"nr-ext-speed-sub",speedAddBtn:"nr-ext-speed-add",settingsSpeedTrigger:"nr-ext-settings-speed-trigger",settingsSpeedMenu:"nr-ext-settings-speed",settingsSpeedSlider:"nr-ext-settings-speed-slider",settingsSpeedText:"nr-ext-settings-speed-text",settingsSpeedFactorText:"nr-ext-settings-speed-factor-text",settingsSpeedSubBtn:"nr-ext-settings-speed-sub",settingsSpeedAddBtn:"nr-ext-settings-speed-add",volumeTrigger:"nr-ext-volume-trigger",volumeMenu:"nr-ext-volume",volumeSlider:"nr-ext-volume-slider",volumeText:"nr-ext-volume-text",volumeSubBtn:"nr-ext-volume-sub",volumeAddBtn:"nr-ext-volume-add",ccContainer:"nr-ext-cc",closeCC:"btn-close-cc",ccText:"nr-ext-cc-text",progressTimeTotal:"nr-ext-progress-time-total",progressTimeCurr:"nr-ext-progress-time-curr",progressLabel:"nr-ext-progress-label",progressSlider:"nr-ext-progress-bar",progressContainer:"nr-ext-progress",feedbackBtn:"nr-ext-settings-feedback",uploadBtn:"nr-ext-pdf",convertToPdfAgainBtn:"nr-ext-btn-convert-to-pdf-again",saveToMobileBtn:"nr-ext-save-to-mobile",mobileLoginBtn:"nr-ext-mobile-login",saveToMobileInit:"nr-ext-mobile-init",saveToMobileSaving:"nr-ext-mobile-saving",saveToMobileFinish:"nr-ext-mobile-finish",saveToMobileErrorMsg:"nr-ext-mobile-error",maxBtn:"nr-ext-max",minBtn:"nr-ext-min",settingsBtn:"nr-ext-settings-trigger",settingsCloseBtn:"nr-ext-settings-close",settingsAccountBtn:"nr-ext-account-trigger",accountClose:"nr-ext-account-close",accountBack:"nr-ext-account-back",mobileTrigger:"nr-ext-mobile",mobileClose:"nr-ext-mobile-close",mobileBack:"nr-ext-mobile-back",themeTrigger:"nr-ext-theme-trigger",themeClose:"nr-ext-theme-close",themeBack:"nr-ext-theme-back",themeSelect:"nr-ext-theme-select",highlightTrigger:"nr-ext-highlight-trigger",highlightClose:"nr-ext-read-option-close",highlightBack:"nr-ext-read-option-back",otherTrigger:"nr-ext-more-trigger",otherClose:"nr-ext-other-close",otherBack:"nr-ext-other-back",quickSettings:"nr-ext-quick-trigger",quickClose:"nr-ext-start-option-close",quickBack:"nr-ext-start-option-back",toggleVoicesTrigger:"nr-ext-toggle-trigger",toggleVoicesClose:"nr-ext-toggle-close",toggleVoicesBack:"nr-ext-toggle-back",immersiveBtn:"nr-ext-immersive-toggle",quickStartToggle:"nr-ext-quick-start-toggle",quickStartWebpageCheckbox:"nr-ext-quick-start-webpage",quickStartPdfCheckbox:"nr-ext-quick-start-pdf",quickStartGoogleDocsCheckbox:"nr-ext-quick-start-googledocs",quickStartEmailCheckbox:"nr-ext-quick-start-email",quickStartWebsiteCheckbox:"nr-ext-quick-start-website",quickStartOptions:"nr-ext-quick-start-group",relocateBtn:"nr-ext-btn-relocate",immersiveReader:"nr-ext-immersive-reader",immersiveTextSettingsButton:"nr-ext-immersive-trigger",immersiveCloseBtn:"nr-ext-immersive-close",immersiveTextSpacingToggle:"nr-ext-immersive-toggle-text-spacing",immersiveTextSizeSlider:"nr-ext-immersive-textsize",immersiveTextContainer:"nr-ext-immersive-text-container",immersiveTextContent:"nr-ext-immersive-text",immersiveTextSettingsMenu:"nr-ext-immersive-menu",immersiveDyslexiaToggle:"nr-ext-immersive-toggle-dyslexia",immersiveBlurTextToggle:"nr-ext-immersive-toggle-toggle-blur-text",immersiveNextPageButton:"nr-ext-immersive-next-page",immersivePrevPageButton:"nr-ext-immersive-prev-page",immersiveTotalPages:"nr-ext-immersive-all-page",immersivePagesToolbar:"nr-ext-immersive-reader-pages",immersiveCurrentPageInput:"nr-ext-immersive-current-page",msgBar:"nr-ext-msg-bar",msgBox:"nr-ext-msg-box",mobileMsgOffCheckbox:"ext-msg-hide",msgAndroidButton:"nr-ext-msg-android",msgIosButton:"nr-ext-msg-ios",msgMobileDownload:"nr-ext-msg-download-mobile",msgRateNo:"nr-ext-rate-no",msgRateYes:"nr-ext-rate-yes",msgLeaveReviewButton:"nr-ext-msg-leave-review",versionNumberLbl:"nr-ext-version"},n={both:{key:"both",value:["sentence","word"],text:"Sentence and word"},sentence:{key:"sentence",value:["sentence"],text:"Sentence only"},word:{key:"word",value:["word"],text:"Word only"},none:{key:"none",value:[],text:"None"}};e.indexToProgressTime={},e.isAutoScroll=!0,e.isDyslexic=!1,e.isClickToRead=!0,e.isCC=!1,e.isCCVisible=!1,e.isQuickStartWebpage=!0,e.isQuickStartPdf=!0,e.isQuickStartGoogleDocs=!0,e.isQuickStartEmail=!0,e.isQuickStartThisWebsite=!0,e.isDarkTheme=!1,e.isReadIcon=!0;e.uploadPdfUrl="",e.settings={};const i='@font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-Regular.otf);\n        font-style: normal;\n        font-weight: normal;\n        font-display: fallback;\n      }\n      @font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-Italic.otf);\n        font-style: italic;\n        font-weight: normal;\n        font-display: fallback;\n      }\n      @font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-Bold.otf);\n        font-weight: bold;\n        font-style: normal;\n        font-display: fallback;\n      }\n      @font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-BoldItalic.otf);\n        font-weight: bold;\n        font-style: italic;\n        font-display: fallback;\n      }';async function s(){try{await new Promise((n=>{for(let n in t)e[n]=e.shadow.getElementById(t[n]);n()})).catch((e=>{})),await new Promise((t=>{const n={constrain:!1,handle:e.dragHandle,onMouseDown:P,onMouseUp:A,customMove:R};function i(){let t=e.settings.speed-5;t>=50&&(Ve(t),w("speed",t))}function s(){let t=e.settings.speed+5;t<=540&&(Ve(t),w("speed",t))}function o(t){w("speed",parseInt(t)),Ee(e.settings.speed),De(ttsText.textsForTts)}displace(e.container,n),e.container.style.position="fixed",e.exitBtn.onclick=()=>{G(),ke()},e.readBtn.onclick=X,e.forwardBtn.onclick=reader.forward,e.backwardBtn.onclick=reader.backward,e.voiceMenuCloseBtn.onclick=function(){O("init")},e.voiceMenuBtn.onclick=function(){O("voice")},e.voiceSearchBtn.onclick=function(){e.voiceActions.classList.add("ext-searching"),e.voiceSearchInput.focus()},e.voiceSearchClose.onclick=function(){e.voiceSearchInput.value="",e.voiceActions.classList.remove("ext-searching");let t=voices.getVoice(e.settings.selectedVoice).languageName;e.languageList.value=t,w("voiceLanguage",""),x(voices.allVoicesMap.get(t))},e.maxBtn.onclick=()=>{console.error("click max"),a("max")},e.minBtn.onclick=()=>{console.error("click min"),a("min")},e.settingsBtn.onclick=()=>{N("settings")},e.settingsCloseBtn.onclick=()=>{N("init")},e.hotkeysBtn.onclick=()=>{Q("hotkeys")},e.hotkeyClose.onclick=()=>{Q("init")},e.hotkeyBack.onclick=()=>{N("init")},e.hotkeyEditBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"editHotkeys"},(()=>{chrome.runtime.lastError}))},e.settingsAccountBtn.onclick=()=>{F("account")},e.accountClose.onclick=()=>{F("init")},e.accountBack.onclick=()=>{N("init")},e.mobileTrigger.onclick=()=>{q("mobile")},e.mobileClose.onclick=()=>{q("init")},e.mobileBack.onclick=()=>{N("init")},e.toggleVoicesTrigger.onclick=()=>{_("toggle")},e.toggleVoicesClose.onclick=()=>{_("init")},e.toggleVoicesBack.onclick=()=>{N("init")},e.otherTrigger.onclick=()=>{U("others")},e.otherClose.onclick=()=>{U("init")},e.otherBack.onclick=()=>{N("init")},e.themeTrigger.onclick=()=>{H("theme")},e.themeClose.onclick=()=>{H("init")},e.themeBack.onclick=()=>{N("init")},e.highlightTrigger.onclick=()=>{j("option")},e.highlightClose.onclick=()=>{j("init")},e.highlightBack.onclick=()=>{N("init")},e.quickSettings.onclick=()=>{W("start")},e.quickClose.onclick=()=>{W("init")},e.quickBack.onclick=()=>{N("init")},e.volumeTrigger.onclick=()=>{"none"==e.volumeMenu.style.display?e.volumeMenu.style.display="flex":e.volumeMenu.style.display="none"},e.settingsSpeedTrigger.onclick=()=>{"none"==e.settingsSpeedMenu.style.display?e.settingsSpeedMenu.style.display="flex":e.settingsSpeedMenu.style.display="none"},e.themeSelect.onchange=()=>{re(e.themeSelect.value)},e.highlightColourMenu.onchange=()=>{B(e.highlightColourMenu.value,e.settings.highlightColour)},e.highlightTypeMenu.onchange=()=>{k(e.highlightTypeMenu.value)},e.immersiveBtn.onclick=()=>{je()},e.quickStartToggle.onclick=t=>{e.quickStartToggle.checked?(ge("webpage",!0),ge("googleDocs",!0),ge("email",!0),ge("pdf",!0),ge("website",!0)):(ge("webpage",!1),ge("googleDocs",!1),ge("email",!1),ge("pdf",!1),ge("website",!1)),ue()},e.quickStartWebpageCheckbox.onclick=()=>{ge("webpage",!e.isQuickStartWebpage,!0)},e.quickStartPdfCheckbox.onclick=()=>{ge("pdf",!e.isQuickStartPdf,!0)},e.quickStartGoogleDocsCheckbox.onclick=()=>{ge("googleDocs",!e.isQuickStartGoogleDocs,!0)},e.quickStartEmailCheckbox.onclick=()=>{ge("email",!e.isQuickStartEmail,!0)},e.quickStartWebsiteCheckbox.onclick=()=>{ge("website",!e.isQuickStartThisWebsite,!0)},e.selectableCharLimit.onchange=t=>{g(parseInt(e.selectableCharLimit.value))},e.speedSubBtn.onclick=()=>{i()},e.settingsSpeedSubBtn.onclick=()=>{i()},e.speedAddBtn.onclick=()=>{s()},e.settingsSpeedAddBtn.onclick=()=>{s()},e.speedSlider.addEventListener("input",(()=>{Ee(parseInt(e.speedSlider.value))})),e.settingsSpeedSlider.addEventListener("input",(()=>{Ee(parseInt(e.settingsSpeedSlider.value))})),e.speedSlider.addEventListener("change",(()=>{let t=parseInt(e.speedSlider.value);o(t),e.settingsSpeedSlider.value=t})),e.settingsSpeedSlider.addEventListener("change",(()=>{let t=parseInt(e.settingsSpeedSlider.value);o(t),e.speedSlider.value=t})),e.volumeSlider.addEventListener("change",(t=>{w("volume",Math.round(100*parseFloat(e.volumeSlider.value))/100)})),e.volumeSlider.addEventListener("input",(t=>{Ae(Math.round(100*parseFloat(e.volumeSlider.value))/100)})),e.volumeSubBtn.onclick=()=>{let t=e.settings.volume-.01;t>=0&&Pe(t)},e.volumeAddBtn.onclick=()=>{let t=e.settings.volume+.01;t<=1&&Pe(t)},e.autoSelectVoiceToggle.onclick=()=>{me(!e.isAutoSelectVoice)},e.clickToReadToggle.onclick=()=>{ae(!e.isClickToRead)},e.readIcon.onclick=()=>{pe(!e.isReadIcon)},e.ccToggle.onclick=()=>{le(!e.isCC)},e.autoScrollToggle.onclick=()=>{te(!e.isAutoScroll,!0)},e.closeCC.onclick=()=>{le(!1)},e.peBtn.onclick=Y,e.helpBtn.onclick=()=>{window.open("https://help.naturalreaders.com/en/collections/785014-naturalreader-online-chrome-extension","_blank")},e.uploadBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"showUploadPage"},(()=>{chrome.runtime.lastError}))},e.convertBtn.onclick=()=>{nrTextProcessor.getTextsFromPage("convert").then((function(e){if(e&&0===e.length)throw new Error("ERR_NO_TEXT");{const t=new Blob([e.join("\n")],{type:"text/plain"}),n=window.URL.createObjectURL(t);chrome.runtime.sendMessage({fn:"setFile",url:n,fileName:"ext-file.txt"},(()=>{chrome.runtime.lastError}))}})).catch((function(e){return e&&e.message?chrome.runtime.sendMessage({fn:"displayAlertMessage",message:e.message}):chrome.runtime.sendMessage({fn:"displayAlertMessage",message:new Error("ERR_UNKNOWN")})}))},e.loginBtn.onclick=V,e.mobileLoginBtn.onclick=V,e.logoutBtn.onclick=M,e.billingBtn.onclick=J,e.onboardLogin.onclick=()=>{Ze(!1),V()},e.signupBtn.onclick=E,e.onboardSignup.onclick=()=>{Ze(!1),E()},e.feedbackBtn.onclick=()=>{!function(){const t=reader.docType;let n="N/A";e.settings.loggedIn&&(n=e.settings.userInfo.email);let i={docType:t,texts:ttsText.textsForTts.map((e=>e.original)).join(""),voiceType:e.settings.voiceType,freeVoice:e.settings.freeVoice,premVoice:e.settings.premVoice,plusVoice:e.settings.plusVoice,email:n,speed:e.settings.speed,volume:e.settings.volume,index:reader.currReadIndex,originalText:ttsText.textsForTts[reader.currReadIndex]?ttsText.textsForTts[reader.currReadIndex].original:null,processedText:ttsText.textsForTts[reader.currReadIndex]?ttsText.textsForTts[reader.currReadIndex].processed:null,appVersion:chrome.runtime.getManifest().version};chrome.runtime.sendMessage({fn:"openReportIssues",issue:i},(()=>{chrome.runtime.lastError}))}()},e.saveToMobileBtn.onclick=we,e.convertToPdfAgainBtn.onclick=we,e.resetBtn.onclick=Z,e.progressSlider.addEventListener("change",(function(e){let t=Ne(parseInt(this.value));reader.readIndex(t)})),e.progressSlider.addEventListener("input",(function(t){clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null,Re(Ne(parseInt(this.value)),!1)})),e.relocateBtn.onclick=()=>{"reading"===reader.state&&"undefined"!=typeof nrDomController&&("kindle"===doc.type?nrDomController.highlightLocation(reader.currReadIndex):nrDomController.scrollTo(reader.currReadIndex)),"kindle"!==doc.type&&ne()},e.exitBtn.onclick=()=>{G(),ke()},Array.from(e.onboard.getElementsByClassName("btn-onboard-close")).forEach((e=>{e.onclick=()=>{reader.stop(),Ze(!1)}})),Array.from(e.onboard.getElementsByClassName("nr-ext-onboard-skip")).forEach((e=>{e.onclick=()=>{reader.stop(),Ze(!1)}})),Array.from(e.onboard.getElementsByClassName("nr-ext-onboard-next")).forEach((t=>{t.onclick=()=>{let t=parseInt(e.onboard.getAttribute("onboard-step"));1===t&&reader.stop(),t<3?e.onboard.setAttribute("onboard-step",t+1):Ze(!1)}})),Array.from(e.msgBox.getElementsByClassName("nr-ext-msg-close")).forEach((e=>{e.onclick=l})),Array.from(e.msgBar.getElementsByClassName("nr-ext-msg-close")).forEach((e=>{e.onclick=l})),e.mobileMsgOffCheckbox.onchange=t=>{e.mobileMsgOffCheckbox.checked&&(e.isShowMobileMessage=!1,w("isShowMobileMessage",!1))},e.msgAndroidButton.onclick=()=>{K("android")},e.msgIosButton.onclick=()=>{K("ios")},e.msgMobileDownload.onclick=()=>{z("msgBar",!1),z("msgBox",!0)},e.msgRateNo.onclick=()=>{l(),chrome.runtime.sendMessage({fn:"openReportIssues"},(()=>{chrome.runtime.lastError}))},e.msgRateYes.onclick=()=>{D(e.msgBox,"msg-type","review")},e.msgLeaveReviewButton.onclick=()=>{window.open("https://chrome.google.com/webstore/detail/natural-reader-text-to-sp/kohfgcgbkjodfcfkcackpagifgbcmimk","_blank"),l()},t()})).catch((e=>{})),await r(),await async function(){try{if(e.immersiveTextSettingsButton.onclick=()=>{"open"===$(e.immersiveReader).attr("menu-status")?(e.immersiveTextSettingsMenu.style.display="none",e.immersiveReader.setAttribute("menu-status","close")):(e.immersiveTextSettingsMenu.style.display="block",e.immersiveReader.setAttribute("menu-status","open"))},e.immersiveCloseBtn.onclick=()=>{je()},e.immersiveDyslexiaToggle.onclick=()=>{ie(!e.isDyslexic)},e.immersiveBlurTextToggle.onclick=()=>{se(!e.settings.isImmersiveBlurText)},e.isImmersiveTextSpacing=e.settings.isImmersiveTextSpacing,e.immersiveTextSize=e.settings.immersiveTextSize,Xe(e.isImmersiveTextSpacing),function(t,n=!0){e.immersiveTextSizeSlider.value=t,e.immersiveTextContent.setAttribute("text-scale",t),n&&w("immersiveTextSize",t)}(e.immersiveTextSize,!1),se(e.settings.isImmersiveBlurText),e.immersiveTextSpacingToggle.onclick=()=>{Xe(!e.isImmersiveTextSpacing)},e.immersiveTextContent.setAttribute("text-scale",e.immersiveTextSize),e.immersiveTextSizeSlider.addEventListener("change",(()=>{e.immersiveTextSize=parseFloat(e.immersiveTextSizeSlider.value),e.immersiveTextContent.setAttribute("text-scale",e.immersiveTextSize),w("immersiveTextSize",e.immersiveTextSize)})),"undefined"!=typeof doc&&("googleDoc"===doc.type||"googleDrivePreview"===doc.type)){e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",e.immersivePagesToolbar.style.display="flex";const t=doc.getNumPages();e.immersiveTotalPages.innerText=t,e.immersiveCurrentPageInput.value=doc.getPageIndex(),e.immersiveCurrentPageInput.max=t,$(e.immersiveCurrentPageInput,e.shadow).on("keyup",(function(t){if("Enter"===t.key||13===t.keyCode){const t=e.immersiveCurrentPageInput.value;t&&t>=1&&t<=doc.getNumPages()?Ge(t-1):e.immersiveCurrentPageInput.value=doc.getPageIndex()+1}})),$e(),e.immersivePrevPageButton.onclick=qe((()=>{Ge(doc.getPageIndex()-1)})),e.immersiveNextPageButton.onclick=qe((()=>{Ge(doc.getPageIndex()+1)}))}}catch(e){}}(),e.isVoicesInit||await u(),chrome.runtime.sendMessage({fn:"addMostListenedWebsite",origin:location.origin})}catch(e){}}function o(t,n){return new Promise(((i,s)=>{let o;if(!t){let e=n.match(/\.([^.]+)$/);e&&(t=e[1])}t||(t="js");const r="nr-ext-"+n;n=chrome.runtime.getURL(n),"css"===t?(o=document.createElement("link"),o.id=r,o.type="text/css",o.rel="stylesheet",o.href=n,o.onload=()=>{n.includes("nr-ext-reading-bar.css")&&(Be(!0),w("isVisible",!0))},e.shadow.appendChild(o),i()):"js"===t?(o=document.createElement("script"),o.id=r,fetch(n).then((e=>e.text())).then((t=>{o.textContent=t,e.shadow.appendChild(o),i()})).catch((e=>{i()}))):i()})).catch((e=>{}))}function r(t,i,s){return new Promise((t=>{chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(async i=>{if(chrome.runtime.lastError,e.settings=i,e.voiceType=e.settings.voiceType,e.versionNumberLbl.innerText="Version "+chrome.runtime.getManifest().version,e.settings.freeVoice=e.settings.freeVoice?e.settings.freeVoice:voices.defaultFreeVoice,e.settings.premVoice=e.settings.premVoice?e.settings.premVoice:voices.defaultPremVoice,e.settings.plusVoice=e.settings.plusVoice?e.settings.plusVoice:voices.defaultPlusVoice,e.settings.selectedVoice=e.settings.selectedVoice?e.settings.selectedVoice:voices.defaultPlusVoice,e.settings.preset1Voice=e.settings.preset1Voice?e.settings.preset1Voice:voices.defaultPremVoice,e.settings.preset2Voice=e.settings.preset2Voice?e.settings.preset2Voice:voices.defaultPremVoice,e.settings.preferredVoicesByLang=0===Object.keys(e.settings.preferredVoicesByLang).length?voices.preferredVoicesByLang:e.settings.preferredVoicesByLang,voices.preferredVoicesByLang=e.settings.preferredVoicesByLang,Ie(e.settings.userInfo,e.settings.loggedIn),e.messageType=e.settings.messageType?e.settings.messageType:"signup",e.messageTime="messageTime"in e.settings?e.settings.messageTime:null,e.messageFirstDay="messageFirstDay"in e.settings?e.settings.messageFirstDay:null,e.rateMessageTime="rateMessageTime"in e.settings?e.settings.rateMessageTime:null,!e.messageFirstDay){const t=Date.now();w("messageFirstDay",t),e.messageFirstDay=t}e.isShowMobileMessage=!("isShowMobileMessage"in e.settings)||e.settings.isShowMobileMessage,e.isShowRateMessage=!("isShowRateMessage"in e.settings)||e.settings.isShowRateMessage,e.isShowSignupMessage=!("isShowSignupMessage"in e.settings)||e.settings.isShowSignupMessage;let s=n.none;e.settings.beHighlighted.length>0&&(s=e.settings.beHighlighted.length>1?n.both:n[e.settings.beHighlighted[0]]),B(e.settings.highlightColour,"light"),k(s.key),"kindle"!==doc.type&&"googleDoc"!==doc.type||le(e.settings.isCC),ge("webpage",e.settings.isQuickStartWebpage),ge("pdf",e.settings.isQuickStartPdf),ge("googleDocs",e.settings.isQuickStartGoogleDocs),ge("email",e.settings.isQuickStartEmail),e.isQuickStartThisWebsite=!(location.origin in e.settings.quickStartBlackList),ge("website",e.isQuickStartThisWebsite),ue(),"kindle"===doc.type&&(e.ccToggle.style.display="inline-block",e.immersiveBtn.style.display="none",e.mobileTrigger.style.display="none"),"googleDoc"===doc.type&&(e.ccToggle.style.display="inline-block",e.immersiveBtn.style.display="none"),"googleDrivePreview"===doc.type&&(e.immersiveBtn.style.display="none"),Se(e.settings.highlightColour),ie(e.settings.isDyslexic),e.systemTheme=e.settings.systemTheme,re(e.settings.theme),te(e.settings.isAutoScroll),me(e.settings.isAutoSelectVoice),e.isVoicesInit?("pinned"==e.settings.voiceLanguage?(e.languageList.value="pinned",x(e.settings.pinnedVoices,"pinned")):(e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,x(voices.allVoicesMap.get(voices.getVoice(e.settings.selectedVoice).languageName))),e.preset1VoiceList.value=e.settings.preset1Voice,e.preset2VoiceList.value=e.settings.preset2Voice):await u(),Ve(e.settings.speed,!1),Pe(e.settings.volume,!1),g(e.settings.LimitedReadSelectionCharAmount),"reading"===reader.state?ve():"pause"===reader.state?xe():"loading"===reader.state?he():fe();-1!=navigator.userAgent.indexOf("Mac")||(e.hotkeyActivateText.innerHTML="Alt + R"),e.showOnboard?(Ze(!0),"gpt"==doc.type&&(e.settings.mode="min"),chrome.runtime.sendMessage({fn:"setShowOnboard",val:!1},(()=>{chrome.runtime.lastError}))):e.onboard&&e.onboard.remove(),a(e.settings.mode),t()}))})).then((()=>{e.settings.isVisible&&t&&(t.beingReadTabId&&t.beingReadTabId===t.tabId&&t.activeTabId===t.tabId||!t.beingReadTabId&&t.tabId&&t.activeTabId===t.tabId)?Be(!0):Be(!1)})).catch((e=>{}))}function a(t){e.container.setAttribute("ext-size",t),e.mode=t,"min"===e.mode&&(e.relocateBtn.style.display="none",l()),w("mode",t)}async function c(t){try{e.capsule=document.createElement("DIV"),e.capsule.style.display="none",e.capsule.id="nr-ext-capsule",e.capsule.style.width=0,e.capsule.style.height=0,e.capsule.style.left=0,e.capsule.style.bottom=0,e.capsule.style.display="none",e.shadow=e.capsule.attachShadow({mode:"open"}),await async function(){try{await o(null,"injected/nr-ext-reading-bar/nr-ext-reading-bar.css"),function(){const e=document.createElement("style");e.dataset.description="nr-ext-dyslexic-fonts",e.appendChild(document.createTextNode(i)),document.head.appendChild(e)}()}catch(e){}}();const n=document.createElement("DIV");n.innerHTML=t;const s=[],r=document.getElementsByTagName("body")[0];for(;n.children.length>0;)s.push(n.children[0]),e.shadow.appendChild(n.children[0]);r.appendChild(e.capsule)}catch(e){}}function l(){z("msgBar",!1),z("msgBox",!1)}function d(t){e.messageTime=Date.now(),t||(t=e.messageType),w("messageType",t),w("messageTime",e.messageTime)}function g(t){e.selectableCharLimit.value=t,w("LimitedReadSelectionCharAmount",t)}function u(){return new Promise((function(t){voices.isSettingVoices||(e.isVoicesInit=!0,function(){e.languageList.innerHTML="";const t=m(Array.from(voices.allVoicesMap.keys()));t.unshift("Pinned Voices");for(let n=0;n<t.length;n++){const i=t[n],s=document.createElement("OPTION");s.innerText=i,s.value="Pinned Voices"===i?"pinned":i,e.languageList.appendChild(s)}e.languageList.addEventListener("change",(function(){v(e.languageList.value)}))}(),"pinned"==e.settings.voiceLanguage?(e.languageList.value="pinned",x(e.settings.pinnedVoices,"pinned")):(e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,x(voices.allVoicesMap.get(voices.getVoice(e.settings.selectedVoice).languageName))),e.voiceSearchInput.addEventListener("input",f),function(){const t=Array.from(Object.values(voices.allVoices));for(let n=0;n<t.length;n++){let i=t[n],s="plus"===i.type?"Plus":"prem"===i.type?"Premium":"Free",o=i.name+" ("+i.languageName+") ("+s+")",r=document.createElement("option");r.value=i.key,r.innerText=o;let a=document.createElement("option");a.value=i.key,a.innerText=o,e.preset1VoiceList.appendChild(r),e.preset2VoiceList.appendChild(a)}e.preset1VoiceList.onchange=t=>{w("preset1Voice",e.preset1VoiceList.value)},e.preset2VoiceList.onchange=t=>{w("preset2Voice",e.preset2VoiceList.value)},e.preset1VoiceList.value=e.settings.preset1Voice,e.preset2VoiceList.value=e.settings.preset2Voice}(),e.showOnboard&&(!function(){e.onboardLanguageList.innerHTML="";const t=m(Object.keys(voices.onboardVoices));for(let n=0;n<t.length;n++){const i=t[n],s=document.createElement("OPTION");s.innerText=i,s.value=i,e.onboardLanguageList.appendChild(s)}let n=voices.getLanguageName(navigator.language,!0);if(t.includes(n))e.onboardLanguageList.value=n;else{let i=n.split(" (")[0];for(let n=0;n<t.length;n++)if(t[n].includes(i)){e.onboardLanguageList.value=t[n];break}e.onboardLanguageList.value=t[0]}e.onboardLanguageList.addEventListener("change",(function(){p(voices.onboardVoices[this.value])}))}(),p(voices.onboardVoices[e.onboardLanguageList.value]))),t()})).catch((e=>{}))}function m(e){return!e||e.length<=0?[]:e.sort((function(e,t){if(e.includes("Multi-Lingual")&&!t.includes("Multi-Lingual"))return-1;if(!e.includes("Multi-Lingual")&&t.includes("Multi-Lingual"))return 1;if(e.includes("English")&&!t.includes("English"))return-1;if(!e.includes("English")&&t.includes("English"))return 1;if(e.includes("English")&&t.includes("English")){let n=["US","UK","Australia","India","Wales"],i=e.match(/\(([^)]+)\)/)[1],s=t.match(/\(([^)]+)\)/)[1],o=n.indexOf(i),r=n.indexOf(s);return-1==o&&r>-1||-1==r&&o>-1?1:o<r?-1:o>r?1:0}return e<t?-1:e>t?1:0}))}function p(t){e.onboardVoiceList.innerHTML="";let n=[];for(let i=0;i<t.length;i++){const s=t[i];s.type;let o=voices.getVoiceKey(s.name,s.language,"plus");const r=document.createElement("button");n.push(r),r.classList.add("ext-voice-item"),r.ariaLabel="voice for "+this.curLanguage+" - "+s.name,r.id=o;const a=document.createElement("div");a.classList.add("voice-icon");const c=document.createElement("img");c.src=s.icon,c.alt="voice icon for "+this.curLanguage+" - "+s.name,a.appendChild(c);const l=document.createElement("div");l.classList.add("voice-name"),l.innerText=s.name,a.appendChild(l),r.appendChild(a);const d=document.createElement("div");d.classList.add("voice-wave"),r.appendChild(d),r.onclick=t=>{const n=r.querySelector(".voice-wave");n.innerHTML;Array.from(r.parentElement.querySelectorAll(".selected-onboard-voice")).forEach((e=>{e.classList.remove("selected-onboard-voice"),e.classList.remove("playing")})),n.innerHTML='<svg> <use xlink:href="#ext_load_wave"></use> </svg>',r.classList.add("playing"),r.classList.add("selected-onboard-voice"),w("plusVoice",o),w("selectedVoice",o),e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,x(voices.allVoicesMap.get(voices.getVoice(e.settings.selectedVoice).languageName)),y(e.settings.selectedVoice)&&C(e.voiceListMapper,e.settings.selectedVoice),T(o)},e.onboardVoiceList.appendChild(r),0==i&&e.onboardVoiceList.setAttribute("leftmostVoiceIndex",i)}e.onboardVoiceList.setAttribute("leftmostVoiceIndex",0),e.onboardVoiceList.scrollLeft=0,e.onboardVoicePrevBtn.onclick=()=>{let t=parseInt(e.onboardVoiceList.getAttribute("leftmostVoiceIndex"));t>0&&(t-=4,t<0&&(t=0),e.onboardVoiceList.setAttribute("leftmostVoiceIndex",t),n[t].scrollIntoView({inline:"start",behavior:"smooth"}))},e.onboardVoiceNextBtn.onclick=()=>{let t=parseInt(e.onboardVoiceList.getAttribute("leftmostVoiceIndex"));t<n.length+4&&(t+=4,e.onboardVoiceList.setAttribute("leftmostVoiceIndex",t),n[t].scrollIntoView({inline:"start",behavior:"smooth"}))}}function h(){"pinned"!==e.settings.voiceLanguage&&(e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,v(e.languageList.value)),C(e.voiceListMapper,e.settings.selectedVoice)}function v(t){"pinned"===t?(x(e.settings.pinnedVoices,"pinned"),w("voiceLanguage","pinned")):(x(voices.allVoicesMap.get(t)),w("voiceLanguage",""))}function x(t,n){e.voiceList.innerHTML="";let i=[];for(let s=0;s<t.length;s++){let o=t[s];"pinned"===n&&(o=voices.allVoices[o]);const r=o.language+"_"+o.name,a="radio_"+r,c="play_"+r,l=e.settings.pinnedVoices.includes(o.key),d=document.createElement("DIV");d.classList.add("nr-ext-voice-cell"),d.id=r,d.setAttribute("ext-pin",l);const g=document.createElement("DIV");g.classList.add("nr-ext-voice-pin"),g.innerHTML='<svg class="ext-pin"> <use xlink:href="#ext_pin_outline"></use></svg><svg class="ext-pinned"><use xlink:href="#ext_pinned"></use></svg>',d.appendChild(g);const u=document.createElement("label");u.classList.add("nr-ext-radio-label"),u.setAttribute("for",a),u.classList.add("nr-ext-selectable"),u.setAttribute("value",o.key),d.appendChild(u),g.onclick=t=>{t.stopPropagation(),e.settings.pinnedVoices.includes(o.key)?(e.settings.pinnedVoices.splice(e.settings.pinnedVoices.indexOf(o.key),1),d.setAttribute("ext-pin",!1),"pinned"==e.languageList.value&&g.parentNode.remove()):(e.settings.pinnedVoices.push(o.key),d.setAttribute("ext-pin",!0)),w("pinnedVoices",e.settings.pinnedVoices)};const m=document.createElement("IMG");m.classList.add("nr-ext-voice-icon"),m.src=b(o),m.alt="icon for "+r,u.appendChild(m);const p=document.createElement("DIV");p.classList.add("nr-ext-voice-name");let h=document.createElement("SPAN");if(h.style.fontWeight="bold",h.style.color="#0078d4","plus"===o.type&&("openai"===o.source?h.innerText=" LLM":h.innerText=" AI"),"pinned"===n)p.innerText=o.name+" ("+o.languageName+")";else{const e="plus"===o.type?"Plus":"prem"===o.type?"Premium":"Free";p.innerText=o.name+(o.displayLocale?" ("+o.localeName+")":"")+" ("+e+")"}u.appendChild(p),p.appendChild(h);const v=document.createElement("DIV"),x=document.createElement("BUTTON");x.classList.add("nr-btn-icon","nr-ext-voice-play"),x.ariaLabel="preview for "+r,x.id=c,x.innerHTML='<svg class="ext-editable"> <use xlink:href="#ext_speaker"></use> </svg>',x.onclick=()=>{T(o.key)},v.appendChild(x);const f=document.createElement("INPUT");f.classList.add("nr-ext-voice-radio"),f.name="nr-ext-voice",f.type="radio",f.value=r,f.id=a,v.appendChild(f),f.onchange=e=>{},d.appendChild(v),"pinned"==e.languageList.value?(e.voiceList.prepend(d),i.unshift(o)):(e.voiceList.appendChild(d),i.push(o)),d.onclick=e=>{const t=e.target;x&&(x.contains(t)||t===x)||g&&(g.contains(t)||t===g)||L(u)}}!function(t,n){const i=e[t];i.options.length=0;for(let e in n){if(t.includes("free")&&n[e].isPrem)continue;const s=document.createElement("option");s.text=n[e].key,s.value=n[e].key,i.add(s)}i.onchange=qe(I)}("voiceListMapper",i),y(e.settings.selectedVoice)?C(e.voiceListMapper,e.settings.selectedVoice):function(t){let n=t.includes("("),i=t.split(" "),s=n?i[0]+" "+i[1]:i[0],o=i.slice(-2)[0],r=i[i.length-1];e.voiceIcon.src=b({name:s,language:o,type:r}),"plus"!=r?e.voiceIcon.classList.add("icon-svg"):e.voiceIcon.classList.contains("icon-svg")&&e.voiceIcon.classList.remove("icon-svg")}(e.settings.selectedVoice)}function f(t){x(Object.values(voices.allVoices).filter((t=>t.name.toLowerCase().includes(e.voiceSearchInput.value.toLowerCase()))))}function y(t){let n=Array.from(e.voiceListMapper.getElementsByTagName("option"));for(let e=0;e<n.length;e++)if(n[e].value===t)return!0;return!1}function b(e){if("plus"===e.type){const t="https://wwwnaturalreaderscom.s3.amazonaws.com/pw-portraits/",n=voices.getLanguageName(e.language,!1,!1).toLocaleLowerCase(),i=e.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t+n+"/"+("english"===n?i+".jpg":i.split(" (")[0]+".jpg")}return"prem"===e.type?chrome.runtime.getURL("/assets/img/prem.svg"):chrome.runtime.getURL("/assets/img/free.svg")}function T(e){reader.preview(e)}function k(t){e.highlightTypeMenu.value=t,w("beHighlighted",n[t].value);const i=e.highlightColourMenu.value;S(i,i)}function B(t,n){e.highlightColourMenu.value=t,S(t,n),w("highlightColour",t)}function S(t,n){const i=e.highlightTypeMenu.value;let s="nr-sentence-highlight-"+t,o="nr-word-highlight-"+t;switch(function(t){let n="nr-sentence-highlight-"+t,i="nr-word-highlight-"+t;Array.from(e.highlightPreview.getElementsByClassName("nr-ext-sentence")).forEach((e=>{e.classList.remove(n)})),Array.from(e.highlightPreview.getElementsByClassName("nr-ext-word")).forEach((e=>{e.classList.remove(i)}))}(n),i){case"both":Array.from(e.highlightPreview.getElementsByClassName("nr-ext-sentence")).forEach((e=>{e.classList.add(s)})),Array.from(e.highlightPreview.getElementsByClassName("nr-ext-word")).forEach((e=>{e.classList.add(o)}));break;case"sentence":Array.from(e.highlightPreview.getElementsByClassName("nr-ext-sentence")).forEach((e=>{e.classList.add(s)}));break;case"word":Array.from(e.highlightPreview.getElementsByClassName("nr-ext-word")).forEach((e=>{e.classList.add(o)}))}}function L(t){const n=t.getAttribute("value");C(e.voiceListMapper,n)}function I(t){let n="";if(n=t.target.value.includes("plus")?"plus":t.target.value.includes("prem")?"prem":"free",n){w("voiceType",n);let i=t.target.value.includes("("),s=t.target.value.split(" "),o=i?s[0]+" "+s[1]:s[0],r=s.slice(-2)[0];e.voiceIcon.src=b({name:o,language:r,type:n}),"plus"!=n?e.voiceIcon.classList.add("icon-svg"):e.voiceIcon.classList.contains("icon-svg")&&e.voiceIcon.classList.remove("icon-svg"),w(n+"Voice",t.target.value),w("selectedVoice",t.target.value)}!function(e){try{const t=e.parentElement.querySelector("input");t&&!t.checked&&(t.checked=!0)}catch(e){}}(e.voiceList.querySelectorAll(".nr-ext-selectable")[t.target.selectedIndex])}function C(e,t){let n=e;const i=new Event("change");n&&null!==t&&(n.value=t),n&&n.dispatchEvent(i)}function w(t,n,i=null){"voiceType"===t&&n!==e.settings.voiceType?(reader.setTts(n),i&&i.sameLang&&voices.autoSelectVoice(e.settings[e.settings.voiceType+"Voice"].split(" ").slice(-2)[0],n),reader.replay()):"freeVoice"==t||"premVoice"==t||"plusVoice"==t?(i&&!i.isAutoSelected&&voices.rememberPreferredVoiceByLang(t.split("Voice")[0],n),"default"===n&&(n=voices[n+(t.charAt(0).toUpperCase()+t.slice(1))]),n!==e.settings[t]&&(reader.setTts(e.settings.voiceType),reader.replay())):("speed"===t&&n!==e.settings.speed||"volume"===t&&n!==e.settings.volume)&&reader.replay(),e.settings[t]=n,i&&i.toPlay&&reader.play(),chrome.runtime.sendMessage({fn:"setReadingBarSetting",key:t,value:n},(()=>{chrome.runtime.lastError}))}function M(){chrome.runtime.sendMessage({fn:"logout"},(()=>{chrome.runtime.lastError}))}function V(){chrome.runtime.sendMessage({fn:"login"},(()=>{chrome.runtime.lastError}))}function E(){chrome.runtime.sendMessage({fn:"signup"},(()=>{chrome.runtime.lastError}))}function P(){document.body.style.pointerEvents="none"}function A(){document.body.style.pointerEvents="unset"}function R(e,t,n){const i=window.innerHeight,s=window.innerWidth;let o=e.getBoundingClientRect(),r=o.right-o.left,a=o.bottom-o.top;e.style.right=t>=0&&t+r<=s?s-(t+r)+"px":t<0?s-r+"px":"0px",e.style.top=n>=0&&n+a<=i?n+"px":n<0?"0px":i-a+"px"}function D(e,t,n){$(e).attr(t,n)}function N(t){const n=e.container.getAttribute("menu-status");"settings"==t?"settings"==n?e.container.setAttribute("menu-status","init"):e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","init")}function O(t){const n=e.container.getAttribute("menu-status");"voice"==t?"voice"==n?e.container.setAttribute("menu-status","init"):e.container.setAttribute("menu-status","voice"):e.container.setAttribute("menu-status","init")}function F(t){const n=e.container.getAttribute("menu-status");"account"==t?"account"==n?e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","account"):e.container.setAttribute("menu-status","settings")}function q(t){const n=e.container.getAttribute("menu-status");"mobile"==t?"mobile"==n?e.container.setAttribute("menu-status","settings"):(e.container.setAttribute("menu-status","mobile"),Ce("init")):e.container.setAttribute("menu-status","settings")}function U(t){const n=e.container.getAttribute("menu-status");"others"==t?"others"==n?e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","others"):e.container.setAttribute("menu-status","settings")}function Q(t){const n=e.container.getAttribute("menu-status");"hotkeys"==t?"hotkeys"==n?e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","hotkeys"):e.container.setAttribute("menu-status","settings")}function H(t){const n=e.container.getAttribute("menu-status");"theme"==t?"theme"==n?e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","theme"):e.container.setAttribute("menu-status","settings")}function j(t){const n=e.container.getAttribute("menu-status");"option"==t?"option"==n?e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","option"):e.container.setAttribute("menu-status","settings")}function W(t){const n=e.container.getAttribute("menu-status");"start"==t?"start"==n?e.container.setAttribute("menu-status","others"):e.container.setAttribute("menu-status","start"):e.container.setAttribute("menu-status","others")}function _(t){const n=e.container.getAttribute("menu-status");"toggle"==t?"toggle"==n?e.container.setAttribute("menu-status","others"):e.container.setAttribute("menu-status","toggle"):e.container.setAttribute("menu-status","others")}function z(t,n=!0){e[t]&&(e[t].style.display=n?"block":"none")}function G(){reader.stop()}function X(){if("pause"===reader.state||"init"===reader.state)if(nrDomDetector.hasSelectionOnPage(!1))ee();else if(!doc||"googleDoc"!==doc.type&&"googleDrivePreview"!==doc.type)if(doc&&"kindle"===doc.type){doc.isSameText()||reader.stop(),reader.play({caller:"readBtn"})}else reader.play({caller:"readBtn"});else if("googleDoc"===doc.type){let e=null;be();const t=setInterval((function(){if(!doc.isRendering){ye(),clearInterval(t),e&&clearTimeout(e);const n=doc.getPageIndex(),i=doc.getCurrentIndex();n!==i?reader.readPage(i,0):reader.play({caller:"readBtn"})}}),100);e=setTimeout((()=>{clearInterval(t),ye()}),6e4)}else{const e=doc.getPageIndex(),t=doc.getCurrentIndex();e!==t?reader.readPage(t):reader.play({caller:"readBtn"})}else reader.pause(!0),function(){const t=null!=e.messageTime?utils.getDiffInDay(e.messageTime):null,n=null!=e.messageFirstDay?utils.getDiffInDay(e.messageFirstDay):null;(null==t||t>=1)&&(null==e.rateMessageTime&&n>=2||null!=e.rateMessageTime&&utils.getDiffInDay(e.rateMessageTime)>=60?(a("max"),z("msgBar",!1),z("msgBox",!0),D(e.msgBox,"msg-type","rate"),e.messageTime=Date.now(),w("messageTime",e.messageTime),w("rateMessageTime",e.messageTime)):"mobile"!==e.messageType&&e.isShowMobileMessage?(e.messageType="mobile",a("max"),D(e.msgBar,"msg-type","mobile"),D(e.msgBox,"msg-type","mobile"),w("isShowMobileMessage",!1),e.isShowMobileMessage=!1,z("msgBar",!0),z("msgBox",!1),d()):!e.settings.loggedIn&&e.isShowSignupMessage&&(e.messageType="signup",a("max"),z("msgBar",!0),D(e.msgBar,"msg-type","signup"),w("isShowSignupMessage",!1),e.isShowSignupMessage=!1,d()))}()}function K(e){let t="";t="ios"===e?"https://apps.apple.com/app/id1487572960":"https://play.google.com/store/apps/details?id=com.naturalsoft.personalweb",window.open(t,"_blank")}function Y(){window.open("https://www.naturalreaders.com/online/?action=pe&source=ext-pe","_blank")}function J(){window.open("https://www.naturalreaders.com/online/?action=billing&source=ext-billing","_blank")}function Z(){chrome.runtime.sendMessage({fn:"reload"},(()=>{chrome.runtime.lastError}))}function ee(){chrome.runtime.sendMessage({fn:"readSelection"},(()=>{chrome.runtime.lastError})),nrDomDetector.frame.style.display="none"}function te(t,n=!1){e.isAutoScroll=t,ce(e.isAutoScroll,e.autoScrollToggle),w("isAutoScroll",t),n&&chrome.runtime.sendMessage({fn:"relocate"},(()=>{chrome.runtime.lastError}))}function ne(){e.relocateBtn.style.display="none"}function ie(t){e.isDyslexic=t,ce(e.isDyslexic,e.immersiveDyslexiaToggle),w("isDyslexic",e.isDyslexic),function(t){t?(e.ccText.classList.add("dyslexicfonts"),e.immersiveTextContainer.classList.add("dyslexicfonts")):e.immersiveTextContainer.classList.remove("dyslexicfonts")}(t)}function se(t){ce(t,e.immersiveBlurTextToggle),w("isImmersiveBlurText",t),oe(t)}function oe(t){const n=e.immersiveReader.getElementsByTagName("nr-sentence");for(let e=0;e<n.length;e++)t?(n[e].classList.remove("nr-not-read"),n[e].classList.add("nr-not-read-blur")):(n[e].classList.remove("nr-not-read-blur"),n[e].classList.add("nr-not-read"))}function re(t){e.theme=t,e.themeSelect.value=t,w("theme",e.theme),"system"===e.theme&&(t=e.systemTheme),"light"==t?(e.dragHandle.querySelector("svg").style.fill="#3d5aa1",e.dragHandle.querySelector("svg").style.color="#3d5aa1"):(e.dragHandle.querySelector("svg").style.fill="#e0e6ef",e.dragHandle.querySelector("svg").style.color="#e0e6ef"),D(e.ext,"ext-theme",t)}function ae(t,n=!1){return new Promise((i=>{if(e.isClickToRead=t,w("isClickToRead",e.isClickToRead),e.isClickToRead)if(reader.isFirstRead&&"all"===reader.readOption)if(e.readBtn.classList.add("nr-ext-spin"),e.readBtn.style.pointerEvents="none",e.forwardBtn.style.pointerEvents="none",e.backwardBtn.style.pointerEvents="none",n)e.readBtn.classList.remove("nr-ext-spin"),e.readBtn.style.pointerEvents="auto",e.forwardBtn.style.pointerEvents="auto",e.backwardBtn.style.pointerEvents="auto",i();else{let t="all";nrDomDetector.hasSelectionOnPage(!1)&&(t="selection"),reader.setTextsForTtsWithoutPlay(t),e.readBtn.classList.remove("nr-ext-spin"),e.readBtn.style.pointerEvents="auto",e.forwardBtn.style.pointerEvents="auto",e.backwardBtn.style.pointerEvents="auto",i()}else i();else i();ce(e.isClickToRead,e.clickToReadToggle)})).catch((e=>{}))}function ce(e,t){t.checked=!!e}function le(t){e.isCC=t,ce(e.isCC,e.ccToggle),e.isCC?(w("isCC",!0),"reading"===reader.state?de(!0):de(!1),e.ccToggle.classList.add("on")):(w("isCC",!1),de(!1),e.ccToggle.classList.remove("on"))}function de(t){t?(e.ccContainer.style.display="block",e.isCCVisible=!0):(e.ccContainer.style.display="none",e.isCCVisible=!1)}function ge(t,n=null,i=!1){"webpage"===t?(w("isQuickStartWebpage",n),e.isQuickStartWebpage=n,e.quickStartWebpageCheckbox.checked=e.isQuickStartWebpage):"pdf"===t?(w("isQuickStartPdf",n),e.isQuickStartPdf=n,e.quickStartPdfCheckbox.checked=e.isQuickStartPdf):"email"===t?(w("isQuickStartEmail",n),e.isQuickStartEmail=n,e.quickStartEmailCheckbox.checked=e.isQuickStartEmail,e.isQuickStartEmail||("undefined"!=typeof outlookUiIcons&&outlookUiIcons.removeIcons(),"undefined"!=typeof gmailIcons&&gmailIcons.removeIcons())):"googleDocs"===t?(w("isQuickStartGoogleDocs",n),e.isQuickStartGoogleDocs=n,e.quickStartGoogleDocsCheckbox.checked=e.isQuickStartGoogleDocs):"website"===t&&(e.isQuickStartThisWebsite=n,e.isQuickStartThisWebsite?chrome.runtime.sendMessage({fn:"removeQuickStartBlackList"},(()=>{chrome.runtime.lastError})):chrome.runtime.sendMessage({fn:"addQuickStartBlackList"},(()=>{chrome.runtime.lastError})),e.quickStartWebsiteCheckbox.checked=e.isQuickStartThisWebsite),i&&ue()}function ue(){e.isQuickStartWebpage||e.isQuickStartPdf||e.isQuickStartGoogleDocs||e.isQuickStartEmail||e.isQuickStartThisWebsite?ce(!0,e.quickStartToggle):ce(!1,e.quickStartToggle)}function me(t){e.isAutoSelectVoice=t,ce(e.isAutoSelectVoice,e.autoSelectVoiceToggle),w("isAutoSelectVoice",t)}function pe(t){e.isReadIcon=t,ce(e.isReadIcon,e.readIcon),w("readIcon",e.isReadIcon),null!=nrDomDetector&&nrDomDetector.switchIcon(t)}function he(){if(e.container.setAttribute("play-state","play"),e.readBtn.classList.add("nr-ext-spin"),e.forwardBtn.disabled=!0,e.backwardBtn.disabled=!0,"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.add("nr-ext-spin"),e.classList.add("nr-ext-pause"),e.classList.remove("nr-ext-play"),e.setAttribute("nr-ext-reader-state","reading"))}}function ve(){if(e.readBtn&&e.readBtn.classList.contains("nr-ext-spin")&&e.readBtn.classList.remove("nr-ext-spin"),e.container.setAttribute("play-state","play"),e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,"kindle"!==doc.type&&"googleDoc"!==doc.type||(e.ccToggle.style.display="inline-block"),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!0),"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.contains("nr-ext-spin")&&e.classList.remove("nr-ext-spin"),e.classList.add("nr-ext-pause"),e.classList.remove("nr-ext-play"),e.setAttribute("nr-ext-reader-state","reading"))}"undefined"!=typeof nrTitleBar&&nrTitleBar&&nrTitleBar.shadow&&nrTitleBar.shadow.getElementById("nr-ext-title-bar").setAttribute("data-play","play")}function xe(){if(e.readBtn&&e.readBtn.classList.contains("nr-ext-spin")&&e.readBtn.classList.remove("nr-ext-spin"),"init"!==reader.state&&e.container.setAttribute("play-state","pause"),e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,e.ccToggle.style.display="none",ne(),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!1),"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.remove("nr-ext-pause"),e.classList.add("nr-ext-play"),e.setAttribute("nr-ext-reader-state","pause"),e.classList.contains("nr-ext-spin")&&e.classList.remove("nr-ext-spin"))}"undefined"!=typeof nrTitleBar&&nrTitleBar&&nrTitleBar.shadow&&nrTitleBar.shadow.getElementById("nr-ext-title-bar").setAttribute("data-play","pause")}function fe(){if(e.readBtn&&e.readBtn.classList.contains("nr-ext-spin")&&e.readBtn.classList.remove("nr-ext-spin"),e.container.setAttribute("play-state","init"),reader.state="init",e.ccToggle.style.display="none",de(!1),ne(),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!1),"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.remove("nr-ext-pause"),e.classList.add("nr-ext-play"),e.setAttribute("nr-ext-reader-state","pause"),e.classList.contains("nr-ext-spin")&&e.classList.remove("nr-ext-spin"))}"kindle"===doc.type&&doc.hideHighlightCanvas(),"undefined"!=typeof nrTitleBar&&nrTitleBar&&nrTitleBar.shadow&&nrTitleBar.shadow.getElementById("nr-ext-title-bar").setAttribute("data-play","pause")}function ye(){xe(),clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null}function be(){he()}function Te(t,n,i){if(doc&&"googleDoc"===doc.type&&!doc.hasAnnotated)return chrome.runtime.sendMessage({fn:"displayAlertMessage",message:"ERR_DOCS_NO_ANNOTATED"}),i(!1);if(t.tabId&&(nrDomController.beingReadTabId=t.tabId),t.activeTabId&&(nrDomController.activeTabId=t.activeTabId),!e.isInjectingReadingBar&&!e.hasReadingBar){if("undefined"!=typeof nrQuickStart){nrQuickStart=null;const e=document.getElementById("nr-ext-quick-start-capsule");e&&e.remove()}e.isInjectingReadingBar=!0,e.showOnboard=!!t.showOnboard&&t.showOnboard,chrome.runtime.sendMessage({fn:"setIcon",state:"loading"},(()=>{chrome.runtime.lastError})),e.loadingTimer||(e.loadingTimer=setTimeout((()=>{clearTimeout(e.loadingTimer),chrome.runtime.sendMessage({fn:"setIcon"},(()=>{chrome.runtime.lastError}))}),1e4)),fetch(chrome.runtime.getURL("injected/nr-ext-reading-bar/nr-ext-reading-bar.html")).then((e=>e.text())).then((e=>new Promise((async t=>{await c(e),t()})))).then((async()=>{let n=!1;t.isEmail&&(n=t.isEmail),await async function(t=!1){await s(),e.hasReadingBar=!0,chrome.runtime.sendMessage({fn:"setIcon"},(()=>{chrome.runtime.lastError})),clearTimeout(e.loadingTimer),e.isInjectingReadingBar=!1,ce(e.isClickToRead,e.clickToReadToggle)}(n),e.inactivityTimeout=setTimeout((()=>{reader.setIsSpeechMark(!1)}),2e4),document.addEventListener("mousedown",utils.debounce(et,1e3)),document.addEventListener("wheel",utils.debounce(et,1e3)),document.addEventListener("keydown",utils.debounce(et,1e3)),document.addEventListener("touchstart",utils.debounce(et,1e3)),document.addEventListener("touchmove",utils.debounce(et,1e3)),document.addEventListener("visibilitychange",(e=>{"visible"!==document.visibilityState&&reader.setIsSpeechMark(!1)})),window.addEventListener("keyup",(function(e){"ArrowUp"==e.key?reader.backward():"ArrowDown"==e.key&&reader.forward()})),i(!0)})).catch((e=>{}))}}function ke(t,n,i){t&&t.toShow||"none"===e.ext.style.display?(Be(!0),w("isVisible",!0),r(t),reader.isFirstRead&&("undefined"!=typeof nrTextProcessor&&nrTextProcessor.resetDocInnerTexts(),ae(e.isClickToRead))):(Be(!1),w("isVisible",!1)),t.beingReadTabId&&(nrDomController.beingReadTabId=t.beingReadTabId),t.activeTabId&&(nrDomController.activeTabId=t.activeTabId)}function Be(t){t?(e.ext.style.display="block",e.capsule.style.display="block"):(je(!1),de(!1),"undefined"!=typeof nrAlert&&nrAlert&&nrAlert.hideAlert(),e.ext.style.display="none")}function Se(t,n=null){e.ccContainer&&(n&&e.ccContainer.classList.remove("nr-sentence-highlight-"+n),e.ccContainer.classList.add("nr-sentence-highlight-"+t))}function Le(t){t||(e.userEmail.innerText=""),t.email&&t.email!=e.defaultEmail?e.userEmail.innerText=t.email:e.userEmail.innerText=""}function Ie(t,n){n?(e.loginUI.style.display="none",e.emailUI.style.display="block",e.saveToMobileBtn.style.display="block",e.mobileLoginBtn.style.display="none",e.logoutBtn.style.display="inline-block",e.peBtn&&(e.peBtn.disabled=!1),e.onboard&&"none"!==e.onboard.style.display&&Ze(!1),Le(t)):(e.loginUI.style.display="block",e.emailUI.style.display="none",e.logoutBtn.style.display="none",e.saveToMobileBtn.style.display="none",e.mobileLoginBtn.style.display="block",e.peBtn&&(e.peBtn.disabled=!0),Le(t))}function Ce(t="init"){switch(t){case"init":default:e.saveToMobileErrorMsg.style.display="none",e.saveToMobileFinish.style.display="none",e.saveToMobileSaving.style.display="none",e.saveToMobileInit.style.display="block";break;case"saving":e.saveToMobileErrorMsg.style.display="none",e.saveToMobileFinish.style.display="none",e.saveToMobileSaving.style.display="block",e.saveToMobileInit.style.display="none";break;case"finish":e.saveToMobileErrorMsg.style.display="none",e.saveToMobileFinish.style.display="block",e.saveToMobileSaving.style.display="none",e.saveToMobileInit.style.display="none";break;case"error":e.saveToMobileErrorMsg.style.display="block",e.saveToMobileFinish.style.display="none",e.saveToMobileSaving.style.display="none",e.saveToMobileInit.style.display="none"}}function we(){return"googleDoc"===doc.type||"gpt"===doc.type?function(){if(e.isSavingToMobile)return;e.isSavingToMobile=!0;const t=e.settings.userInfo?e.settings.userInfo.id:"";Ce("saving"),doc.parseForConvertToPdf().then((function(n){fetch(chrome.runtime.getURL("assets/template.html")).then((e=>e.text())).then((i=>{let s="";if("gpt"===doc.type&&n.length>0)try{s=Array.from(n[0].closest("div.group").previousSibling.getElementsByClassName("empty:hidden"))[0].innerText}catch(e){}else{let e=document.head.getElementsByTagName("title");e.length>0&&(s=e[0].innerText)}var o=Me("Description");""==o&&(o=Me("description"));let r=[];for(var a=0;a!=n.length;a++)if(""!=s)r.push(n[a].innerText);else{const e=n[a].nodeName.toLowerCase();"h1"!=e&&"h2"!=e||(s=n[a].innerText)}for(i+=s+"</div>",i+='<div class="pdf-subtitle">'+o+"</div>",i+='<section class="pdf-content">',a=0;a!=r.length;a++)i+='<p class="pdf-paragraphs">'+r[a]+"</p>";i+="</section></body></html>";const c=new XMLHttpRequest,l=new URLSearchParams;l.set("html",i),l.set("title",s),t&&l.set("userid",t),c.open("POST","https://uploadocr.naturalreaders.com/html2pdf"),c.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&this.status>=400&&(Ce("error"),e.saveToMobileErrorMsg.innerText="Server error"),this.readyState===XMLHttpRequest.DONE&&200===this.status&&Ce("finish"),e.isSavingToMobile=!1},c.onerror=function(t){Ce("error"),e.saveToMobileErrorMsg.innerText="Server error",e.isSavingToMobile=!1};try{c.send(l)}catch(t){Ce("error"),e.saveToMobileErrorMsg.innerText="Server or unknown error",e.isSavingToMobile=!1}})).catch((t=>{Ce("error"),e.saveToMobileErrorMsg.innerText="Unknown error",e.isSavingToMobile=!1}))})).catch((t=>{Ce("error"),e.saveToMobileErrorMsg.innerText="Error getting texts from the page",e.isSavingToMobile=!1}))}():function(){if(e.isSavingToMobile)return;let t=location.href;e.isSavingToMobile=!0;let n="NaturalReader_PDF";const i=e.settings.userInfo?e.settings.userInfo.id:"";let s="";Ce("saving");const o="https://readability.naturalreaders.com/";let r={url:t,service:"urltojson"};e.settings.userInfo&&e.settings.userInfo.email&&(s=e.settings.userInfo.email,r.userEmail=s);const a={"Content-Type":"application/json"};return fetch(o+"urltojson",{method:"POST",mode:"cors",cache:"no-cache",headers:a,referrer:"client",referrerPolicy:"origin-when-cross-origin",body:JSON.stringify(r)}).then((e=>e.json())).then((e=>(n=e.title,r={htmlContent:e.content,service:"jsontopdf",url:t,title:n},i&&(r.userId=i),s&&(r.userEmail=s),fetch(o+"jsontopdf",{method:"POST",mode:"cors",cache:"no-cache",headers:a,referrer:"client",referrerPolicy:"origin-when-cross-origin",body:JSON.stringify(r)})))).then((e=>e.json())).then((t=>{Ce("finish"),e.isSavingToMobile=!1})).catch((t=>{Ce("error"),e.saveToMobileErrorMsg.innerText="Error saving page",e.isSavingToMobile=!1}))}()}function Me(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n].getAttribute("content");return""}function Ve(t,n=!0){e.speedSlider.value=t,e.settingsSpeedSlider.value=t,Ee(t),n&&w("speed",t)}function Ee(t){e.speedText.innerHTML=t+"<br>wpm",e.settingsSpeedText.innerHTML=t+" wpm",e.settingsSpeedFactorText.innerHTML=function(e){let t=Math.round(e/180*100)/100;"00"==t.toString().split(".")[1]&&(t=Math.round(t));return t}(t)}function Pe(t,n=!0){e.volumeSlider.value=t,Ae(t),n&&w("volume",t)}function Ae(t){e.volumeText.innerText=Math.round(100*t)+"%"}async function Re(t=0,n=!0){e.progressTimeCurr.innerText=e.indexToProgressTime[t]?e.indexToProgressTime[t].displayedTime:"0:00",n&&(e.progressSlider.value=e.indexToProgressTime[t]?e.indexToProgressTime[t].seconds:0)}function De(t=null){try{if(!t)return;let n=0;t.map(((t,i)=>{if(0===i)e.indexToProgressTime[i]={displayedTime:"0:00",seconds:0};else{const t=Math.round(n/Oe(e.settings.speed));e.indexToProgressTime[i]={displayedTime:Fe(t),seconds:t}}n+=t.processed.length}));const i=Math.round(n/Oe(e.settings.speed));e.progressSlider.max=i,e.progressSlider.value=0,e.indexToProgressTime[t.length]={displayedTime:Fe(i),seconds:i},e.progressTimeTotal.innerText=Fe(Math.round(n/Oe(e.settings.speed)))}catch(e){}}function Ne(t){isNaN(t)&&(t=parseInt(t));let n=Object.keys(e.indexToProgressTime);for(let i=0;i<n.length;i++){let n=e.indexToProgressTime[i].seconds,s=e.indexToProgressTime[i+1]?e.indexToProgressTime[i+1].seconds:null;if(t>=n&&(t<s||null==s))return i}return 0}function Oe(e){return isNaN(e)&&(e=parseInt(e)),e/180*5}function Fe(e){const t=parseInt(e,10);let n=Math.floor(t/3600),i=Math.floor((t-3600*n)/60),s=t-3600*n-60*i;return n>=1&&n<10&&(n="0"+n),i<10&&(i="0"+i),s<10&&(s="0"+s),n<1?i+":"+s:n+":"+i+":"+s}function qe(e,t=500,n=!0){var i;return function(){var s=this,o=arguments,r=function(){i=null,n||e.apply(s,o)},a=n&&!i;clearTimeout(i),i=setTimeout(r,t),a&&e.apply(s,o)}}function Ue(t,n){$(e.ccText).empty();let i=document.createTextNode(t);e.ccText.appendChild(i)}function Qe(t){const n=t.matches;e.systemTheme=n?"dark":"light",re("system"),chrome.runtime.sendMessage({message:"systemThemeOnChange",value:e.systemTheme})}chrome.runtime.onMessage.addListener((function(t,n,i){if(t.fn in readingBar){if(readingBar[t.fn](t,n,i),readingBar.isAsyncFunction(t.fn))return!0}else{if("injectReadingBar"===t.message)return Te(t,0,i),!0;"textsToReadOnChange"===t.message?De(t.texts):"tabOnActivated"===t.message?r(t):"setLoggedInUI"===t.fn||"setLoggedOutUI"===t.fn?chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(async t=>{chrome.runtime.lastError,e.settings=t,e.settings.userInfo&&Ie(e.settings.userInfo,e.settings.loggedIn)})):"readSelectionOnEnd"===t.message||("toggleShowReadIcon"===t.message?pe(t.value):"highlightColourOnChange"===t.message?Se(t.highlightColour,t.oldHighlightColour):"systemThemeOnChange"===t.message?(e.systemTheme=t.value,re("system")):"setReadingBarSetting"===t.message&&w(t.key,t.value,t.data))}}));const He=window.matchMedia("(prefers-color-scheme: dark)");He.matches?e.systemTheme="dark":e.systemTheme="light";try{He.addEventListener("change",(e=>{Qe(e)}))}catch(e){try{He.addListener((e=>{Qe(e)}))}catch(e){}}function je(t=null){null===t?(e.isImmersive=!e.isImmersive,e.isImmersive?We():_e()):(e.isImmersive=t,t?We():_e())}function We(){e.immersiveBtn.classList.add("on"),"undefined"!=typeof nrTextProcessor&&(!reader.isFirstRead&&nrTextProcessor.isSameText()?(e.immersiveReader.style.display="block",e.ext.setAttribute("immersive",!0)):(Ke(),reader.setTextsForTtsWithoutPlay(),e.immersiveReader.style.display="block",e.ext.setAttribute("immersive",!0)))}function _e(){e.immersiveBtn.classList.remove("on"),e.ext.setAttribute("immersive",!1),"googleDoc"!==doc.type&&(document.body.style.overflowY="auto"),ze(),e.immersiveReader.style.display="none"}function ze(){e.immersiveTextSettingsMenu.style.display="none",e.immersiveReader.setAttribute("menu-status","close")}function Ge(e){if("reading"===reader.state)reader.readPage(e);else if(doc.scrollToPage)return doc.scrollToPage(e).then((e=>{reader.setTextsForTtsWithoutPlay()}))}async function $e(){if(void 0===doc.getPageIndex)return;const t=doc.getPageIndex();e.immersiveCurrentPageInput.value=t+1,e.immersivePrevPageButton.disabled=0===t;const n=doc.getNumPages();e.immersiveNextPageButton.disabled=t>=n-1||-1==t}function Xe(t){e.isImmersiveTextSpacing=t,e.isImmersiveTextSpacing?(e.immersiveTextSpacingToggle.setAttribute("toggle-status","on"),e.immersiveTextContainer.classList.add("nr-text-spacing")):(e.immersiveTextSpacingToggle.setAttribute("toggle-status","off"),e.immersiveTextContainer.classList.remove("nr-text-spacing")),w("isImmersiveTextSpacing",e.isImmersiveTextSpacing)}function Ke(){e.immersiveTextContainer.innerHTML=""}function Ye(t){return new Promise((n=>{for(let n=0;n<t.length;n++){const i=t[n];let s=null;"h1"===i.tagName.toLowerCase()?(s=document.createElement("H1"),s.classList.add("nr-immersive-heading1")):"h2"===i.tagName.toLowerCase()?(s=document.createElement("H2"),s.classList.add("nr-immersive-heading2")):s=document.createElement("P");const o=Array.from(i.querySelectorAll("nr-sentence"));let r=-1;for(let t=0;t<o.length;t++){const n=o[t].classList;let i=-1;for(let e=0;e<n.length;e++)if(n[e].includes("nr-s")){i=parseInt(o[t].id.split("nr-s")[1]);break}if(r!=i){const n=nrTextProcessor.textsToRead[i],a=o[t].cloneNode(!0);a.innerHTML="";const c=document.createTextNode(n);utils.isRtlText(n)&&s.classList.add("nr-rtl"),a.appendChild(c),a.removeAttribute("class"),sentenceId="nr-immersive-s"+i,a.classList.add(sentenceId),a.id=sentenceId,nrDomController.bindClickToReadEventsForImmersiveReader(a),s.appendChild(a),s.appendChild(document.createTextNode(" ")),e.immersiveTextContainer.appendChild(s),r=i}}}n()})).catch((e=>{}))}function Je(){e.isDyslexic&&e.immersiveTextContainer.classList.add("dyslexicfonts")}async function Ze(t){t?e.onboard.style.display="flex":("prem"===e.settings.voiceType?w("plusVoice","default"):"plus"===e.settings.voiceType&&w("premVoice","default"),e.onboard.remove())}function et(){"undefined"!=typeof nrDomController&&nrDomController.activeTabId&&nrDomController.activeTabId===nrDomController.beingReadTabId&&(e.inactivityTimeout&&(reader.setIsSpeechMark(!0),clearTimeout(e.inactivityTimeout),e.inactivityTimeout=null),e.inactivityTimeout||(e.inactivityTimeout=setTimeout((()=>{reader.setIsSpeechMark(!1)}),2e4)))}}var readingBar=readingBar||new NRExtReadingBar;