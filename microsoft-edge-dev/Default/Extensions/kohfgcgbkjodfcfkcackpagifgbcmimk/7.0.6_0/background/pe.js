chrome.pe=new function(){let e=this;e.getPeListForUser=function(e=!1,s=null){var a;e&&s&&(a=s.id,chrome.cognitoUser?chrome.cognitoUser.getSession((function(e,s){if(s){const e={Authorization:s.idToken.jwtToken,"Content-Type":"application/json"},r=new URLSearchParams({userId:a});return fetch(t+"?"+r,{method:"GET",mode:"cors",cache:"no-cache",headers:e,referrer:"client",referrerPolicy:"origin-when-cross-origin"}).then((e=>e.json())).then((e=>e.pe?o(n(e.pe)):o([]))).catch((e=>o([])))}console.error("pe getSession error",e)})):o([]))},e.setPeAndTts=o,e.getPeLastUpdated=function(t,n,s){s(e.lastUpdated)},e.getLastestPe=function(t,n,s){s({peList:e.peList,peMap:e.peMap,lastUpdated:e.lastUpdated})},e.getPeListAndMap=function(t,n,s){s({peList:e.peList,peMap:e.peMap})},e.isAsyncFunction=function(t){return e.asyncFunctions.includes(t)},e.peList=[],e.peMap=new Map,e.asyncFunctions=[],e.lastUpdated=null;const t="https://sgglax06i9.execute-api.us-east-1.amazonaws.com/prod/pe";function n(e){return e?e.map(s.bind(this)):[]}function s(e){let t=function(e){const t=/[\*\.\?\+\$\^\[\]\(\)\{\}\|\\\/\:\<\>\=\-]/g,n=/[^ -~]/g;let s=e,a=!1;return(t.test(e)||n.test(e))&&(a=!0,s=e.replace(t,(function(e){return"\\"+e}))),{hasSpecialChars:a,processedText:s}}(e.source),n={hasSpecialChars:!1,processedText:e.replace};return{...e,processedSource:e.source,processedReplace:n.processedText,hasSpecialChars:t.hasSpecialChars||n.hasSpecialChars,ignoreWordBoundary:e.ignoreWordBoundary,matchCase:e.matchCase}}function a(e){o(n(e.peList))}function o(t){e.peList=t,e.peMap=e.peList.reduce(((e,t)=>(e.set(t.source,t.replace),e)),new Map),chrome.storage.sync.set({peList:e.peList}),e.lastUpdated=Date.now();const n=extension.beingReadTabId?extension.beingReadTabId:extension.activeTabId?extension.activeTabId:null;null!=n&&chrome.tabs.sendMessage(n,{fn:"setPeAndTts",peList:e.peList,lastUpdated:e.lastUpdated},(()=>{chrome.runtime.lastError}))}!function(){chromeRuntimeMsgExternal.setFilter("setPeData",a.bind(this)),chrome.runtime.onMessage.addListener((function(t,n,s){if(e[t.fn]&&(e[t.fn](t,n,s),e.isAsyncFunction(t.fn)))return!0}))}()};