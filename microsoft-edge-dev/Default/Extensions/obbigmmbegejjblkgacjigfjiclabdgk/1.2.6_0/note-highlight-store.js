const NOTE_HIGHLIGHT_KEY="note-highlight-key",selectionKey=e=>`selection-${e}`;var noteHighlightedUrls={},selectionsForPage={};function initStorageForPage(e){fetchSelectionsForPage(e),fetchNoteHighlightedUrls()}function fetchSelectionsForPage(e){chrome.storage.local.get([selectionKey(e)],function(o){o&&o[selectionKey(e)]&&(selectionsForPage[e]=o[selectionKey(e)])})}function fetchNoteHighlightedUrls(e){chrome.storage.local.get([NOTE_HIGHLIGHT_KEY],function(o){o&&o[NOTE_HIGHLIGHT_KEY]?(noteHighlightedUrls=o[NOTE_HIGHLIGHT_KEY],e&&e(noteHighlightedUrls)):e&&e([])})}function saveSelectionToStorage(e,o){delete o.node,o.date=Date.now(),selectionsForPage[e]?selectionsForPage[e].push(o):selectionsForPage[e]=[o],saveNewSelectionForPage(e,o.title)}function removeSelectionFromStorage(e,o){for(var t=0;t<selectionsForPage[e].length;t++){if(selectionsForPage[e][t].sid==o)return selectionsForPage[e].splice(t,1),void(selectionsForPage[e].length>0?chrome.storage.local.set({[selectionKey(e)]:selectionsForPage[e]},function(){const o=chrome.runtime.lastError;o&&console.error("failed saving selection:",o,e,selectionsForPage[e])}):removeSelectionForPage(e))}console.error("removeSelectionFromStorage: did not find the selection!")}function saveNewSelectionForPage(e,o){selectionsForPage[e].length>0?chrome.storage.local.set({[selectionKey(e)]:selectionsForPage[e]},function(){const t=chrome.runtime.lastError;t?console.error("failed saving selection:",t,e,selectionsForPage[e]):(selectionsForPage[e],noteHighlightedUrls[e]||(noteHighlightedUrls[e]=o,chrome.storage.local.set({[NOTE_HIGHLIGHT_KEY]:noteHighlightedUrls},function(){const e=chrome.runtime.lastError;e&&console.error("failed saving all urls",e,noteHighlightedUrls)})))}):console.error("no selection for:",e)}function removeSelectionForPage(e){chrome.storage.local.remove([selectionKey(e)],function(){const o=chrome.runtime.lastError;o?console.error("failed remove selection:",o,e):selectionsForPage[e].length<1&&noteHighlightedUrls[e]&&(delete noteHighlightedUrls[e],chrome.storage.local.set({[NOTE_HIGHLIGHT_KEY]:noteHighlightedUrls},function(){const e=chrome.runtime.lastError;e&&console.error("failed saving all urls",e,noteHighlightedUrls)}))})}